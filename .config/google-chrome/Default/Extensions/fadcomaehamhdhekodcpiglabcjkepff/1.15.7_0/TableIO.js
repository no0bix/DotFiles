!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=150)}({10:function(e,t,n){"use strict";t.__esModule=!0;var r=n(2),o=n(6),i=function(){function e(e,t,n){var o=this;this.success=!1,this.getRoot=function(){return o._root},this.getId=function(){return o._id},this.isSuccessful=function(){return o.success},this.setData=function(e){return o.returnData=e},window.r20esDialogId="r20esDialogId"in window?window.r20esDialogId:0,this.centerWorkaround=null!==n&&void 0!==n&&n,this._id="r20es-dialog-"+window.r20esDialogId++,this._root=r.DOM.createElement("dialog",{className:e,style:t,id:this.getId()}),document.body.insertBefore(this.getRoot(),document.body.firstElementChild),window.dialogPolyfill&&window.dialogPolyfill.registerDialog(this.getRoot()),this.close=this.close.bind(this),this.dispose=this.dispose.bind(this)}return e.prototype.internalRender=function(){var e=this;this.getRoot().appendChild(this.render()),window.dialogPolyfill&&window.dialogPolyfill.reposition(this.getRoot()),this.centerWorkaround&&setTimeout(function(){e.recenter()},100)},e.prototype.recenter=function(){var e=this.getRoot(),t=document.body.scrollTop||document.documentElement.scrollTop,n=t+(window.innerHeight-e.offsetHeight)/2;e.style.top=Math.max(t,n)+"px"},e.prototype.rerender=function(){o.removeAllChildren(this.getRoot()),this.internalRender()},e.prototype.internalShow=function(){o.removeAllChildren(this.getRoot()),this.success=!1,this.internalRender(),this.getRoot().showModal()},e.prototype.getData=function(){var e=this.returnData;return this.returnData=null,e},e.prototype.close=function(e){void 0===e&&(e=!1),this.success="boolean"==typeof e&&e,this.getRoot().open&&this.getRoot().close()},e.prototype.dispose=function(){this.close(),o.findByIdAndRemove(this.getId())},e}();t.DialogBase=i},11:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.__esModule=!0;var o=n(2),i=n(6),a=function(e){function t(t,n,r){var i=e.call(this,n,r)||this;return i.show=i.internalShow,i.render=function(){return o.DOM.createElement(l,null,o.DOM.createElement(s,null,o.DOM.createElement("h3",null,i.action,", please wait...")))},i.action=t,i}return r(t,e),t}(n(10).DialogBase);function s(e){return o.DOM.createElement("div",{className:"dialog-body"})}function l(e){return o.DOM.createElement("div",{className:"r20es-dialog"})}t.LoadingDialog=a,t.DialogHeader=function(e){return o.DOM.createElement("div",{className:"dialog-header"})},t.DialogBody=s,t.DialogFooter=function(e){return o.DOM.createElement("div",{className:"dialog-footer"},o.DOM.createElement("hr",null))},t.DialogFooterContent=function(e){return o.DOM.createElement("div",{className:"dialog-footer-content"})},t.Dialog=l,t.CheckboxWithText=function(e){var t=i.copy(e,{style:{verticalAlign:"middle",marginRight:"4px"},type:"checkbox"}),n=o.DOM.createElement("input",t),r=t&&t.component||"div";return o.DOM.createElement(r,null,n,o.DOM.createElement("span",{style:{verticalAlign:"middle"}},t.checkboxText))}},150:function(e,t,n){"use strict";(function(e){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.__esModule=!0;var o=n(4),i=n(5),a=n(151),s=n(16),l=n(2),c=n(91),u=n(6),d=n(11),f=n(24),h=n(152),p=function(t){function n(){var r=t.call(this,e)||this;return r.onExportButtonClicked=function(e){var t=r.getTableId(e.target.parentNode);if(t){var n=i.R20.getRollableTable(t);if(n){var o=a.TableIO.exportJson(n),l=new Blob([o],{type:"data:application/json;charset=utf-8"});s.saveAs(l,n.get("name")+".json")}else alert("Failed to get table. Table id: "+t)}else alert("Failed to get table id.")},r.observerCallback=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];if(r.tryInsertTableWidget(o.target))break}},r.onImportClicked=function(e){var t=e.target.id===n.tableExportImportButtonId?r.importTablesTableExport:r.importTableJson,o=$(e.target.parentNode.parentNode).find("input")[0],i=new d.LoadingDialog("Importing");i.show();var a=o.files[0];u.readFile(a).then(t).catch(alert).finally(i.dispose),o.value="",r.setButtonDisabled(e.target.parentNode,!0)},r.onFileChanged=function(e){r.setButtonDisabled(e.target.parentNode,e.target.files.length<=0)},r.onImportFromPasteClicked=function(e){e.stopPropagation(),r.pasteDialog.show()},r.onPasteDialogClose=function(e){r.pasteDialog.isSuccessful()&&r.importTablesTableExport(r.pasteDialog.getData())},r}return r(n,t),n.prototype.getTableId=function(e){var t=$(e.parentNode).find("div["+f.default.TableIdAttribute+"]");if(t.length<=0)return null;var n=t[0];return n.hasAttribute(f.default.TableIdAttribute)?n.getAttribute(f.default.TableIdAttribute):null},n.prototype.tryInsertTableWidget=function(e){if(!e.className)return!1;if("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"!==e.className)return!1;if(e.getElementsByClassName(n.tableWidgetClass).length>0)return!1;if(!this.getTableId(e))return!1;var t=l.DOM.createElement("button",{style:{marginTop:"8px"},onClick:this.onExportButtonClicked,className:[n.tableWidgetClass,"btn"]},"Export");return e.appendChild(t),!0},n.prototype.importTableJson=function(e){var t=u.safeParseJson(e);t&&a.TableIO.importJson(t)},n.prototype.importTablesTableExport=function(e){if(c.TableExportLang.naiveVerify(e)){console.log(e);var t=null;try{t=c.TableExportLang.parse(e)}catch(e){console.error(e),alert(e)}if(t&&t&&!(t.length<=0))for(var n in t)a.TableIO.importJson(t[n])}},n.prototype.setButtonDisabled=function(e,t){var n=$(e).find(".btn");n.each(function(e){n[e].disabled=t})},n.prototype.setup=function(){if(i.R20.isGM()){this.pasteDialog=new h.default,this.pasteDialog.getRoot().addEventListener("close",this.onPasteDialogClose);for(var e=0,t=document.querySelectorAll(".ui-dialog-titlebar, .ui-widget-header, .ui-corner-all,  .ui-helper-clearfix");e<t.length;e++){var r=t[e];this.tryInsertTableWidget(r)}var o=document.getElementById("deckstables").getElementsByClassName("content")[0],a={width:"100%",marginRight:"8px",marginBottom:"8px"},s=l.DOM.createElement("div",{id:n.journalDivId,style:{marginBottom:"20px"}},l.DOM.createElement(l.SidebarSeparator,null),l.DOM.createElement(l.SidebarCategoryTitle,null,"Import Rollable Table"),l.DOM.createElement("input",{onChange:this.onFileChanged,type:"file",style:{width:"95%"}}),l.DOM.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},l.DOM.createElement("button",{id:n.normalImportButtonId,onClick:this.onImportClicked,disabled:!0,className:"btn",style:a},"Import"),l.DOM.createElement("button",{id:n.tableExportImportButtonId,onClick:this.onImportClicked,disabled:!0,className:"btn",style:a},"Import (TableExport)")),l.DOM.createElement("button",{id:n.tableExportImportFromTextButtonId,onClick:this.onImportFromPasteClicked,className:"btn",style:{width:"90%",float:"unset"}},"Import TableExport (Paste text)"));o.appendChild(s),this.observer=new MutationObserver(this.observerCallback),this.observer.observe(document.body,{childList:!0,subtree:!0})}},n.prototype.dispose=function(){t.prototype.dispose.call(this),this.observer&&this.observer.disconnect(),this.pasteDialog&&this.pasteDialog.dispose();for(var e=document.getElementsByClassName(n.tableWidgetClass),r=e.length;r-- >0;)e[0].remove();u.findByIdAndRemove(n.journalDivId)},n.journalDivId="r20es-tableio-journal-widget",n.tableWidgetClass="r20es-export-table-button",n.normalImportButtonId="r20es-norma;-import-button",n.tableExportImportButtonId="r20es-table-export-import-button",n.tableExportImportFromTextButtonId="r20es-table-export-import-from-text-buttom",n}(o.R20Module.OnAppLoadBase);o.R20Module.canInstall()&&(new p).install()}).call(this,"src/modules/TableIO")},151:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableIO=void 0;var r=n(5);let o={};t.TableIO=o,o.importJson=function(e){if(!e)return;let t=r.R20.createRollableTable();for(let n in e.items){let r=e.items[n];delete r.id,t.tableitems.create(r)}delete e.id,delete e.items,t.save(e)},o.exportJson=function(e){return JSON.stringify(e.attributes,null,4)}},152:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.__esModule=!0;var o=n(10),i=n(11),a=n(2),s=n(91),l=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.onImportClick=function(e){e.stopPropagation();var r=document.getElementById(t.textAreaId);console.log(r),s.TableExportLang.naiveVerify(r.value)&&(n.setData(r.value),n.close(!0))},n.show=n.internalShow,n}return r(t,e),t.prototype.render=function(){return a.DOM.createElement(i.Dialog,null,a.DOM.createElement(i.DialogHeader,null,a.DOM.createElement("h2",null,"Paste TableExport")),a.DOM.createElement(i.DialogBody,null,a.DOM.createElement("div",null,a.DOM.createElement("textarea",{style:{width:"512px",height:"256px"},id:t.textAreaId,autocomplete:!1,autofocus:!0})),a.DOM.createElement("div",null,a.DOM.createElement("a",{href:"javascript:void(0)",onClick:function(){return window.open("https://docs.google.com/document/d/1Y5fMpkcm615KH_9ih-HCagswAdgS1CkBiktKeJABiBY","_blank")}},"Document filled with tables"))),a.DOM.createElement(i.DialogFooter,null,a.DOM.createElement(i.DialogFooterContent,null,a.DOM.createElement("button",{className:"btn",onClick:this.close},"Close"),a.DOM.createElement("button",{className:"btn btn-primary",style:{float:"right"},onClick:this.onImportClick},"Import"))))},t.textAreaId="r20es-paste-table-export-dialog-text-area",t}(o.DialogBase);t.default=l},16:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var r=t.saveAs=window.saveAs||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=function(){return e.URL||e.webkitURL||e},n=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,o=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),i=e.webkitRequestFileSystem,a=e.requestFileSystem||i||e.mozRequestFileSystem,s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l=0,c=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},u=function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){s(e)}}},d=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},f=function s(f,h,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),p||(f=d(f));var g,m,w,v=this,b=f.type,y=!1,T=function(){u(v,"writestart progress write writeend".split(" "))},E=function(){if(m&&o&&"undefined"!=typeof FileReader){var n=new FileReader;return n.onloadend=function(){var e=n.result;m.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),v.readyState=v.DONE,T()},n.readAsDataURL(f),void(v.readyState=v.INIT)}(!y&&g||(g=t().createObjectURL(f)),m)?m.location.href=g:void 0===e.open(g,"_blank")&&o&&(e.location.href=g);v.readyState=v.DONE,T(),c(g)},C=function(e){return function(){if(v.readyState!==v.DONE)return e.apply(this,arguments)}},_={create:!0,exclusive:!1};if(v.readyState=v.INIT,h||(h="download"),r)return g=t().createObjectURL(f),void setTimeout(function(){n.href=g,n.download=h,function(e){var t=new MouseEvent("click");e.dispatchEvent(t)}(n),T(),c(g),v.readyState=v.DONE});e.chrome&&b&&"application/octet-stream"!==b&&(w=f.slice||f.webkitSlice,f=w.call(f,0,f.size,"application/octet-stream"),y=!0),i&&"download"!==h&&(h+=".download"),("application/octet-stream"===b||i)&&(m=e),a?(l+=f.size,a(e.TEMPORARY,l,C(function(e){e.root.getDirectory("saved",_,C(function(e){var t=function(){e.getFile(h,_,C(function(e){e.createWriter(C(function(t){t.onwriteend=function(t){m.location.href=e.toURL(),v.readyState=v.DONE,u(v,"writeend",t),c(e)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&E()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=v["on"+e]}),t.write(f),v.abort=function(){t.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),E)}),E)};e.getFile(h,{create:!1},C(function(e){e.remove(),t()}),C(function(e){e.code===e.NOT_FOUND_ERR?t():E()}))}),E)}),E)):E()},h=f.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=d(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(h.abort=function(){this.readyState=this.DONE,u(this,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t,n){return new f(e,t,n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);t.default=r},2:function(e,t,n){"use strict";var r,o=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};t.__esModule=!0,function(e){e.rerender=function(e,t){var n=e.nextSibling,r=e.parentNode;e.remove();var o=t();return n?r.insertBefore(o,n):r.appendChild(o),o},e.createElement=function(t,n){for(var r,a=[],s=2;s<arguments.length;s++)a[s-2]=arguments[s];var l=null,c="function"==typeof t;c&&t.name&&t.prototype instanceof e.ElementBase?l=new t(n).render():l=c?t(n):document.createElement(t);if(!(l instanceof HTMLElement))return console.error($(i||(i=o(["JSX Render must return a valid element: elem is not an instance of HTMLElement"],["JSX Render must return a valid element: elem is not an instance of HTMLElement"])))),console.table(((r={})['"type" argument']=t,r.Type=typeof l,r.Value=l,r)),console.trace(),null;if(a){var u=document.createDocumentFragment(),d=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r instanceof HTMLElement)u.appendChild(r);else if(Array.isArray(r))d(r);else if("number"==typeof r)u.appendChild(document.createTextNode(r.toString()));else if("string"==typeof r)u.appendChild(document.createTextNode(r));else if(null===r||void 0===r||"boolean"==typeof r)console.log("JSX got an unrenderable child value, assuming it's control flow related: type: "+typeof r+" value: "+r+".");else{var o=[];for(var i in r)o.push(r[i]);d(o)}}};d(a),l.appendChild(u)}var f=function(e){return e.startsWith("on")},h=function(e){return e.substring(2).toLowerCase()};for(var p in n){var g=n[p];if(f(p))l.addEventListener(h(p),g);else if("className"===p)if(g&&Array.isArray(g))for(var m=0,w=g;m<w.length;m++){var v=w[m];!v||v.length<=0||l.classList.add(v)}else"string"==typeof g&&g.length>0&&(l.className=l.className&&l.classList.length>0?l.className+" "+g:g);else if("style"===p)if("string"==typeof g)l.style.cssText=g;else if("object"==typeof g)for(var b in g)g&&(l.style[b]=g[b]);else void 0!==g&&console.error("Unknown style attribute type: "+typeof g+", "+g);else p.startsWith("data")?l.setAttribute(p,g):l[p]=g}return l};var t=function(){return function(){var t=this;this.elementRoot=null,this.render=function(){var e=t.internalRender();return t.setRoot(e),e},this.rerender=function(){return e.rerender(t.getRoot(),function(){return t.render()})},this.setRoot=function(e){return t.elementRoot=e},this.getRoot=function(){return t.elementRoot},this.dispose=function(){t.getRoot().remove()}}}();e.ElementBase=t}(r||(r={})),t.DOM=r;t.SidebarSeparator=function(e){var t=e&&e.big;return r.createElement("div",null,t&&r.createElement("div",{className:"clear",style:{height:t}}),r.createElement("hr",null),t&&r.createElement("div",{className:"clear",style:{height:t}}))};var i;t.SidebarCategoryTitle=function(e){return r.createElement("h3",{style:{marginBottom:"5px",marginLeft:"5px"}})}},24:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={TableIdAttribute:"data-r20es-table-id"}},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=(e=>{const t=e.replace(/\\/g,"/").split("/");if(t.length<=0)throw new Error("Invalid dirname given.");return t[t.length-1]+".js"})},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.R20Module=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}let a={};t.R20Module=a,a.Base=function(){function e(e){!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"getAllHooks",e=>window.r20es.hooks),this.filename=(0,r.default)(e),this.isDisposed=!0}var t=e.prototype;return t.installFirstTime=function(){},t.installUpdate=function(){},t.dispose=function(){},t.internalCanInstall=function(){return!!this.getHook().config.enabled&&(!!this.isDisposed||(console.error("Attempted to install module when it's not disposed."),console.table({"Module filename":this.filename}),console.trace(),!1))},t.internalInstallFirstTime=function(){if(this.internalCanInstall()){try{this.installFirstTime()}catch(e){console.error(e)}this.isDisposed=!1}},t.internalInstallUpdate=function(){if(this.internalCanInstall()){try{this.installUpdate()}catch(e){console.error(e)}this.isDisposed=!1}},t.internalDispose=function(){if(console.log(this),this.isDisposed)return console.error("internalDispose called on module that is already disposed!"),console.table({"Module filename":this.filename}),void console.trace();try{this.dispose()}catch(e){console.error(e)}this.isDisposed=!0},t.setConfigValue=function(e,t){const n=this.getHook(),r=this.getHook().config;if(!(e in r))return void console.error(`Tried to set config of key ${e} to value ${t} but key was not found in the config of module id ${n.id}"`);const o=r[e];r[e]=t,n.saveConfig(),r.enabled&&"onSettingChange"in this&&"function"==typeof this.onSettingChange&&this.onSettingChange(e,o,t)},t.getHook=function(){if(!1 in window.r20es)return null;for(const e in window.r20es.hooks){const t=window.r20es.hooks[e];if(t.filename&&t.filename===this.filename)return t}return null},t.toggleEnabledState=function(e){const t=this.getHook(),n=void 0===e||null===e?!t.config.enabled:e;if(t.config.enabled&&n)return;const r=t.config.enabled;t.config.enabled=n,t.saveConfig(),r&&!n?(console.log("disabling"),this.internalDispose()):!r&&n&&(console.log("enabling"),this.internalInstallUpdate())},t.install=function(){if(!("r20esInstalledModuleTable"in window))return;if(!("r20esDisposeTable"in window))return;console.log(`Installing module filename: ${this.filename}`),!(this.filename in window.r20esInstalledModuleTable)?(console.log("First run"),this.internalInstallFirstTime()):(this.filename in window.r20esDisposeTable&&console.error(`DUPLICATE MODULE FOUND: ${this.filename}`),console.log("Calling install update"),this.internalInstallUpdate()),window.r20esDisposeTable[this.filename]=(()=>{this.dispose()}),window.r20esInstalledModuleTable[this.filename]=this,console.log(`DONE! module ID: ${this.filename}`)},e}(),a.SimpleBase=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.installFirstTime=function(){this.setup()},n.installUpdate=function(){this.setup()},n.setup=function(){},t}(a.Base),a.OnAppLoadBase=function(e){function t(t){var n;return(n=e.call(this,t)||this).setup=n.setup.bind(o(o(n))),n}i(t,e);var n=t.prototype;return n.installFirstTime=function(){window.r20es.isLoading?(this.earlySetup(),window.r20es.onAppLoad.addEventListener(this.setup)):(this.earlySetup(),this.setup())},n.earlySetup=function(){},n.setup=function(){},n.installUpdate=function(){this.installFirstTime()},n.dispose=function(){window.r20es.onAppLoad.removeEventListener(this.setup)},t}(a.Base),a.canInstall=(e=>window.r20es&&"canInstallModules"in window.r20es&&window.r20es.canInstallModules),a.getModule=function(e){return"r20esInstalledModuleTable"in window?window.r20esInstalledModuleTable[e]:null},a.getModuleById=function(e){return"r20esInstalledModuleTable"in window?a.getModule(window.r20es.hooks[e].filename):null}},5:function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(7);!function(e){var t;function n(){return window.d20.engine.unselect()}function r(e){window.d20.engine.select(e)}function i(){return window.currentPlayer}function a(){return window.currentEditingLayer}function s(){try{var e=window.d20.Campaign.attributes.jukeboxfolder;return JSON.parse(e||"[]")}catch(e){console.error("[getJukeboxFileStructure] failed to get fs due to exception",e)}return[]}function l(e){return window.Jukebox.playlist.get(e)}function c(){return window.d20.Campaign.activePage()}function u(){return window.d20.engine.canvas.getObjects()}function d(t){for(var n=0,r=u();n<r.length;n++){var o=r[n],i=e.try_get_canvas_object_model(o);if(i&&i.get("id")===t)return o}return null}function f(e,t,n){n?($(document).on("mancerroll:"+t,function(e,r){$(document).off("mancerroll:"+t),n(e,r)}),window.d20.textchat.doChatInput(e,t)):window.d20.textchat.doChatInput(e)}function h(e){window.d20.textchat.incoming(!1,{who:"system",type:"system",content:e})}function p(){window.d20.engine.redrawScreenNextTick(!1)}!function(e){e[e.NumericAscending=0]="NumericAscending",e[e.NumericDescending=1]="NumericDescending",e[e.Alphabetical=2]="Alphabetical",e[e.AlphabeticalDescending=3]="AlphabeticalDescending",e[e.Card=4]="Card"}(t=e.InitiativeOrdering||(e.InitiativeOrdering={})),function(e){e.Map="map",e.PlayerTokens="objects",e.GMTokens="gmlayer",e.Lighting="walls",e.B20Foreground="foreground",e.B20Weather="weather"}(e.CanvasLayer||(e.CanvasLayer={})),e.setBackgroundStyle=function(e){window.d20.engine.backgroundColor=e},e.setupImageDropTarget=function(e,t,n){var r={model:{save:t},updateModel:n};window.d20.utils.setupAvatar(e,r)},e.getCanvasMousePos=function(){return window.d20.engine.mousePos.slice()},e.onInitiativeChange=function(t){return new o.EventSubscriber("change:turnorder",t,function(){return e.getInitiativeWindow().model})},e.setCanvasObjectLocation=function(t,n,r){var o=e.try_get_canvas_object_model(t);o&&o.save({top:r,left:n})},e.getBlob=function(e,t,n){return void 0===n&&(n=5e3),new Promise(function(r,o){e._getLatestBlob(t,r),setTimeout(o,n)})},e.getCampaign=function(){return window.Campaign},e.canEditCharacter=function(t){var n=t.attributes.controlledby;return!!e.isGM()||(!!n.includes("all")||!!n.includes(e.getCurrentPlayer().id))},e.getHandout=function(e){return window.Campaign.handouts.get(e)},e.createCharacter=function(e){return window.Campaign.characters.create(e)},e.setCanvasObjectDimensions=function(t,n,r){var o=e.try_get_canvas_object_model(t);o&&o.save({width:n,height:r})},e.getCharacter=function(e){return window.Campaign.characters.get(e)},e.getAllCharacters=function(){return window.Campaign.characters.models},e.getAllPages=function(){return window.Campaign.pages.models},e.createRollableTable=function(e){return window.d20.Campaign.rollabletables.create(e)},e.getRollableTable=function(e){return window.d20.Campaign.rollabletables.get(e)},e.getSelectedTokens=function(){return window.d20.engine.selected()},e.unselectTokens=n,e.addTokenToSelection=r,e.selectToken=function(e){n(),r(e)},e.hideTokenRadialMenu=function(){window.d20.token_editor.removeRadialMenu()},e.hideTokenContextMenu=function(){window.d20.token_editor.closeContextMenu()},e.getCurrentPlayer=i,e.getCanvasZoom=function(){return window.d20.engine.canvasZoom},e.getCanvasWidth=function(){return window.d20.engine.canvas.width},e.getCanvasHeight=function(){return window.d20.engine.canvas.height},e.getCanvasOffsetX=function(){return window.d20.engine.currentCanvasOffset[0]},e.getCanvasOffsetY=function(){return window.d20.engine.currentCanvasOffset[1]},e.getPageById=function(e){return window.Campaign.pages.get(e)},e.isGM=function(){return window.is_gm},e.getCurrentLayer=a,e.generateUUID=function(){return window.generateUUID()},e.getCurrentToolName=function(){return window.d20.engine.mode},e.advanceInitiative=function(){window.d20.Campaign.initiativewindow.nextTurn()},e.addTokenToInitiative=function(e){window.d20.Campaign.initiativewindow.addTokenToList(e)},e.addCustomItemToInitiative=function(e,t){window.d20.Campaign.initiativewindow.addTokenToList("-1",e,t)},e.rerenderMacroBar=function(){window.d20.player_settings.refreshMacroBar()},e.rerenderJournalMacros=function(){window.d20.player_settings.refreshRollsList()},e.orderInitiativeBy=function(e){var n,r=((n={})[t.NumericAscending]=".sortlist_numeric",n[t.NumericDescending]=".sortlist_numericdesc",n[t.Alphabetical]=".sortlist_alpha",n[t.AlphabeticalDescending]=".sortlist_alphadesc",n[t.Card]=".sortlist_card",n);if(e in r){var o=r[e];$("#initiativewindow_settings").dialog({modal:!1,title:"Turn Order Settings",beforeClose:function(){}}),$(o).click()}else console.error("Invalid initiative ordering: "+e)},e.getInitiativeWindow=function(){return window.d20.Campaign.initiativewindow},e.getJukeboxFileStructure=s,e.setJukeboxFileStructure=function(t){e.getCampaign().save({jukeboxfolder:JSON.stringify(t)})},e.createPlaylist=function(e){return window.d20.jukebox.addFolderToFolderStructure(e)},e.addTrackToPlaylist=function(e,t){return window.d20.jukebox.addItemToFolderStructure(e,t)},e.getSongById=l,e.getJukeboxPlaylists=function(){for(var e=[],t=0,n=s();t<n.length;t++){var r=n[t];if("string"!=typeof r){for(var o=r,i={id:o.id,name:o.n,mode:o.s,songs:[]},a=0,c=o.i;a<c.length;a++){var u=c[a],d=l(u);d?i.songs.push(d):console.warn("Tried to get song id "+u+" but the query returned a falsy value. Skipping")}e.push(i)}}return e},e.playAudio=function(e,t){window.Jukebox.soundObjs[e]=window.soundManager.createSound({id:e,url:t})},e.createSong=function(e){return window.Jukebox.playlist.create(e)},e.makePlaylistStructure=function(e,t,n){return{id:window.generateUUID(),n:e,s:t,i:n||[]}},e.getInitiativeData=function(){return window.d20.Campaign.initiativewindow.cleanList()},e.setInitiativeData=function(e){window.d20.Campaign.initiativewindow.model.save({turnorder:JSON.stringify(e)})},e.getCurrentPage=c,e.getCurrentPageTokens=u,e.doesTokenContainMouse=function(e,t){return window.d20.engine.canvas.containsPoint(e,t)},e.getCurrentPageTokenByUUID=d,e.try_get_canvas_object_model=function(e){return e._model?e._model:e.model?e.model:null},e.isUsing5EOGLSheet=function(){try{return window.d20.journal.customSheets.workerScripts[0].includes("5th Edition OGL by Roll20")}catch(e){return!1}},e.moveCameraToTokenByUUID=function(e){if(e){var t=d(e);if(t){var n=$("#editor-wrapper")[0];n.scrollTop=Math.floor(t.top*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasHeight/2)+125*window.d20.engine.canvasZoom,n.scrollLeft=Math.floor(t.left*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasWidth/2)+125*window.d20.engine.canvasZoom}}},e.primitiveSay=function(e,t){window.d20.textchat.doChatInput(e,t)},e.say=f,e.sayToSelf=function(t,n){var r='/w "'+i().get("displayname")+'" '+t;n?f(r,e.generateUUID(),n):f(r)},e.saySystemRaw=h,e.saySystem=function(e){h('<span style="background: rgba(6,26,45,255);\n    color: whitesmoke;\n    border: none;\n    display: inline-block;\n    padding: 8px;\n    margin: -15px -5px -7px -45px;    \n    "\n>\n'+e+"\n</span>\n        ")},e.ping=function(e,t,n,r,o){n=n||i().id,window.d20.engine.pings[n]={left:e,top:t,radius:-5,player:n,pageid:r||c().id,currentLayer:o||a()},window.d20.engine.pinging={downx:e,downy:t},p()},e.getFabric=function(){return window.exports.fabric},e.renderAll=p,e.setGMLayerOpacity=function(e){window.d20.engine.gm_layer_opacity=e},e.hasBetteR20=function(){return void 0!==window.d20plus},e.wipeObjectStorage=function(e){for(var t=e.length,n=0;n<t;n++){var r=e.length-1;if(0>r)break;var o=e.models[r];if(!o||void 0===o)break;o.destroy()}e.length<0&&console.error("FAILED TO WIPE OBJECT STORAGE!")},e.doBulkRoll=function(t,n,r,o,i){e.unselectTokens();var a=function(t){if(e.selectToken(t),i){var r=i(t);r&&e.say(n,r.id,r.callback)}else e.say(n)},s=function(){if(e.hideTokenRadialMenu(),e.hideTokenContextMenu(),o)for(var n=0,r=t;n<r.length;n++){var i=r[n];e.addTokenToSelection(i)}};if(0===r){for(var l=0,c=t;l<c.length;l++){var u=c[l];a(u)}s()}else for(var d=r,f=function(e){setTimeout(function(){a(t[e]),e+1===t.length&&s()},d),d+=r},h=0;h<t.length;h++)f(h)}}(r||(r={})),t.R20=r},6:function(e,t,n){"use strict";t.__esModule=!0;var r=n(8);t.copy=function(e,t){var n=Object.assign({},e);return t&&(n=Object.assign(n,t)),n};var o=function(e){if("currentTransform"in e)return e.currentTransform;if("getTransform"in e)return e.getTransform();if(e.mozCurrentTransform){var t=e.mozCurrentTransform;return{a:t[0],b:t[1],c:t[2],d:t[3],e:t[4],f:t[5]}}};t.getTransform=o;t.getRotation=function(e){var t=o(e),n=Math.atan2(t.b,t.a);return n<0&&(n+=2*Math.PI),n};t.findByIdAndRemove=function(e){var t=document.getElementById(e);t&&t.remove()};t.mapObj=function(e,t){return Object.keys(e).reduce(function(n,r){var o=t(e[r],r);return void 0!==o&&null!==o&&n.push(o),n},[])};t.safeCall=function(e){try{e()}catch(e){console.error(e)}};t.removeAllChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)};t.replaceAll=function(e,t,n){return e.replace(new RegExp(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(t),"g"),n)};t.safeParseJson=function(e){try{return JSON.parse(e)}catch(e){alert("File is not a valid JSON file.")}return null};t.readFile=function(e){return new Promise(function(t,n){if(e){var r=new FileReader;r.readAsText(e),r.onload=function(e){t(e.target.result)}}else n("No file given.")})};var i=function(){return chrome||browser};t.getBrowser=i;t.injectScript=function(e){console.log("Injecting "+e);var t=document.createElement("script");t.async=!1,t.src=i().extension.getURL(e),t.onload=function(){t.remove()},document.head.appendChild(t)};t.strIsNullOrEmpty=function(e){return null===e||void 0===e||e.length<=0||e.trim().length<=0};t.createCSSElement=function(e,t){var n=document.createElement("style");return n.innerHTML=e,n.id=t,n};t.getExtUrlFromPage=function(e,t){var n=void 0===t||null===t?1e3:t;return new Promise(function(t,o){try{var i=!1,a=function(){window.removeEventListener("message",l)},s=window.generateUUID(),l=function(e){e.origin===r.Config.appUrl&&e.data.r20esGivesResourceUrl&&e.data.r20esGivesResourceUrl.id===s&&(i=!0,a(),t(e.data.r20esGivesResourceUrl.url))};window.addEventListener("message",l);var c={resource:e,id:s};window.postMessage({r20esWantsResourceUrl:c},r.Config.appUrl),setTimeout(function(){try{i||(a(),o("Timed out after "+n+"ms"))}catch(e){o(e)}},n)}catch(e){o(e)}})}},7:function(e,t,n){"use strict";t.__esModule=!0;var r=function(){function e(e,t,n){this._isSubscribed=!1,this._name=e,this._callback=t,this._targetGetter=n}return e.subscribe=function(t,n,r){var o=new e(t,n,r);return o.subscribe(),o},e.prototype.subscribe=function(){if(!this._isSubscribed){var e=this._targetGetter();"on"in e?e.on(this._name,this._callback):e.addEventListener(this._name,this._callback),this._isSubscribed=!0}},e.prototype.unsubscribe=function(){if(this._isSubscribed){var e=this._targetGetter();"off"in e?e.off(this._name,this._callback):e.removeEventListener(this._name,this._callback),this._isSubscribed=!1}},e}();t.EventSubscriber=r},8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;let r={};t.Config=r,r.appUrl="https://app.roll20.net",r.websiteFeatureUrlTemplate="https://ssstormy.github.io/roll20-enhancement-suite/features#",r.website="https://ssstormy.github.io/roll20-enhancement-suite/",r.discordInvite="https://discord.gg/pKxxvuM",r.contributeUrl="https://ssstormy.github.io/roll20-enhancement-suite/contribute.html"},91:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TableExportLang=void 0;const r=e=>"\n"===e||"\r"===e||"\t"===e||" "===e||"\f"===e||"\v"===e,o=e=>e>="0"&&e<="9";let i=function(){function e(e){this.readHead=0,this.charStream=e}var t=e.prototype;return t.tryMatch=function(e,t){for(let n=0;n<e.length;n++){if(t>=this.charStream.length)return null;if(this.charStream[t]!==e[n])return null;t++}return{idx:t}},t.tryMatchEscapedAscii=function(e){let t=this.tryMatch("<%%",this.readHead);if(!t)return!1;let n="",r=t.idx;for(;this.charStream.length>r&&o(this.charStream[r]);)n+=this.charStream[r++];let i=this.tryMatch("%%>",r);if(!i)return!1;let a=parseInt(n);return NaN!==a&&(this.readHead=i.idx,e.arg+=String.fromCharCode(a),!0)},t.tryMatchEscapedSlashes=function(e){let t=this.tryMatch("[TABLEEXPORT:ESCAPE]",this.readHead);return!!t&&(this.readHead=t.idx,e.arg+="--",!0)},t.nextToken=function(){for(;!(this.charStream.length<=this.readHead);){const e="!"===this.charStream[this.readHead],t=this.charStream.length>this.readHead+1&&"-"===this.charStream[this.readHead]&&"-"===this.charStream[this.readHead+1];if(e||t)break;this.readHead++}if(this.charStream.length<=this.readHead)return{eof:!0};if("!"===this.charStream[this.readHead]){this.readHead++;let e={command:""};for(;!(this.charStream.length<=this.readHead||r(this.charStream[this.readHead]));)e.command+=this.charStream[this.readHead++];return e.command=e.command.trim(),e}if("-"===this.charStream[this.readHead]){this.readHead+=2;let e={arg:""};for(;!(this.charStream.length<=this.readHead+1||"\n"===this.charStream[this.readHead]||"-"===this.charStream[this.readHead]&&"-"===this.charStream[this.readHead+1]);)this.tryMatchEscapedAscii(e)||this.tryMatchEscapedSlashes(e)||(e.arg+=this.charStream[this.readHead++]);return e.arg=e.arg.trim(),e}throw new Error(`Table export lexer matched unknown start of token: ${this.charStream[this.readHead]}`)},e}();const a=(e,t,n)=>e.length<=t?n:e[t].arg;let s=function(){function e(e){this.lexer=e,this.tokenBuffer=null}var t=e.prototype;return t.readArgs=function(e,t){let n=[];for(let r=0;r<e;r++){const o=this.lexer.nextToken();if(!("arg"in o))return this.tokenBuffer=o,n;if(n[r]=o,console.log(n[r]),!n[r])throw new Error(`${t} expected ${e}, got ${r+1}`)}return n},t.nextStatement=function(){const e=void 0!==this.tokenBuffer&&this.tokenBuffer?this.tokenBuffer:this.lexer.nextToken();this.tokenBuffer=null;let t={};do{if(console.log("starting statement parsing"),console.log(e),e.command){if("import-table"===e.command){console.log("Parsing table header"),t.table={};const e=this.readArgs(2,"import-table");if(e.length<=0)throw new Error(`Expected to find 1 or 2 arguments to import-table, but received ${e.length}. Lexer is at char position ${this.lexer.readHead}`);return t.table.name=e[0].arg,t.table.showplayers="show"===a(e,1,"hide"),t}if("import-table-item"==e.command){console.log("Parsing table item"),t.item={};const e=this.readArgs(4,"import-table-item");if(e.length<2)throw new Error(`Expected to find 2, 3 or 4 arguments to import-table-item, but received ${e.length}.Lexer is at char position ${this.lexer.readHead}`);return t.item.tableName=e[0].arg,t.item.name=e[1].arg,t.item.weight=a(e,2,1),t.item.avatar=a(e,3,""),t}throw new Error(`Unknown TableExport command: ${e.command}`)}if(e.eof)return t.eof=!0,t;throw new Error(`Unexpected token: ${e}. Expected a command token. Lexer is at ${this.lexer.readHead}`)}while(void 0===e.eof);return{eof:!0}},e}(),l=function(){function e(e){this.parser=new s(new i(e))}return e.prototype.run=function(){let e=null,t={};do{if(!(e=this.parser.nextStatement()))return;if(e.eof)break;if(e.table)t[e.table.name]=e.table;else if(e.item){let n=t[e.item.tableName];if(!n)throw new Error(`Table not found: ${e.item.tableName}`);n.items=n.items||{},delete e.item.tableName,n.items[e.item.name]=e.item}}while(void 0===e.eof);return console.log(t),t},e}(),c={};t.TableExportLang=c,c.naiveVerify=function(e){let t=0;for(;e.length>t&&r(e[t]);)t++;return"!"===e[t]||(alert("File does not contain valid TableExport data. First character must be !."),!1)},c.parse=(e=>new l(e).run())}});