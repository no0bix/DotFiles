!function(n){var e={};function t(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return n[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=n,t.c=e,t.d=function(n,e,i){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:i})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(i,r,function(e){return n[e]}.bind(null,r));return i},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=103)}({103:function(n,e,t){"use strict";(function(n){var i=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(e,t)};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();e.__esModule=!0;var r=t(4),o=t(5),a=t(76),u=function(e){function t(){var i=e.call(this,n)||this;return i.localInitiativeData=[],i.onTurnOrderChanged=function(n){return i.debouncedDoSorting()},i.doSorting=function(){var n=o.R20.getInitiativeData(),e=t.getNew(i.localInitiativeData,n);if(i.setLocalInitiative(n),!(e.length<=0||n.length<=0)){var r=i.getHook().config;try{if(i.localInitiativeData.length<=0||!r.respectFirstTokenPosition){console.log("NEW INITIATIVE");var u=i.getHook().config.sortBy;o.R20.orderInitiativeBy(u)}else{console.log("APPENDING NEW TOKENS");var l=n[0];u=i.getHook().config.sortBy;o.R20.orderInitiativeBy(u),n=o.R20.getInitiativeData();for(var c=null,s=0;s<n.length;s++)if(a.isEqual(n[s],l)){c=s;break}if(null===c)return console.error("Could not find firstTokenNewIdx"),void console.error(n);var f=[];for(s=c;s<n.length;s++)f.push(n[s]);for(s=0;s<c;s++)f.push(n[s]);i.setLocalInitiative(f),o.R20.setInitiativeData(f)}}catch(n){console.error(n),i.setLocalInitiative(o.R20.getInitiativeData())}}},i.debouncedDoSorting=a.debounce(i.doSorting,1e3),i._sub=o.R20.onInitiativeChange(i.onTurnOrderChanged),i}return i(t,e),t.getNew=function(n,e){for(var t=[],i=0,r=e;i<r.length;i++){for(var o=r[i],a=!1,u=0,l=n;u<l.length;u++){var c=l[u];if(c.id===o.id&&c.pr===o.pr){a=!0;break}}a||t.push(o)}return t},t.prototype.setLocalInitiative=function(n){this.localInitiativeData=JSON.parse(JSON.stringify(n))},t.prototype.setup=function(){o.R20.isGM()&&(this._sub.subscribe(),this.setLocalInitiative(o.R20.getInitiativeData()))},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._sub.unsubscribe()},t}(r.R20Module.OnAppLoadBase);r.R20Module.canInstall()&&(new u).install()}).call(this,"src/modules/AutoSortInitiative")},3:function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=(n=>{const e=n.replace(/\\/g,"/").split("/");if(e.length<=0)throw new Error("Invalid dirname given.");return e[e.length-1]+".js"})},4:function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.R20Module=void 0;var i=function(n){return n&&n.__esModule?n:{default:n}}(t(3));function r(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function o(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}let a={};e.R20Module=a,a.Base=function(){function n(n){!function(n,e,t){e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t}(this,"getAllHooks",n=>window.r20es.hooks),this.filename=(0,i.default)(n),this.isDisposed=!0}var e=n.prototype;return e.installFirstTime=function(){},e.installUpdate=function(){},e.dispose=function(){},e.internalCanInstall=function(){return!!this.getHook().config.enabled&&(!!this.isDisposed||(console.error("Attempted to install module when it's not disposed."),console.table({"Module filename":this.filename}),console.trace(),!1))},e.internalInstallFirstTime=function(){if(this.internalCanInstall()){try{this.installFirstTime()}catch(n){console.error(n)}this.isDisposed=!1}},e.internalInstallUpdate=function(){if(this.internalCanInstall()){try{this.installUpdate()}catch(n){console.error(n)}this.isDisposed=!1}},e.internalDispose=function(){if(console.log(this),this.isDisposed)return console.error("internalDispose called on module that is already disposed!"),console.table({"Module filename":this.filename}),void console.trace();try{this.dispose()}catch(n){console.error(n)}this.isDisposed=!0},e.setConfigValue=function(n,e){const t=this.getHook(),i=this.getHook().config;if(!(n in i))return void console.error(`Tried to set config of key ${n} to value ${e} but key was not found in the config of module id ${t.id}"`);const r=i[n];i[n]=e,t.saveConfig(),i.enabled&&"onSettingChange"in this&&"function"==typeof this.onSettingChange&&this.onSettingChange(n,r,e)},e.getHook=function(){if(!1 in window.r20es)return null;for(const n in window.r20es.hooks){const e=window.r20es.hooks[n];if(e.filename&&e.filename===this.filename)return e}return null},e.toggleEnabledState=function(n){const e=this.getHook(),t=void 0===n||null===n?!e.config.enabled:n;if(e.config.enabled&&t)return;const i=e.config.enabled;e.config.enabled=t,e.saveConfig(),i&&!t?(console.log("disabling"),this.internalDispose()):!i&&t&&(console.log("enabling"),this.internalInstallUpdate())},e.install=function(){if(!("r20esInstalledModuleTable"in window))return;if(!("r20esDisposeTable"in window))return;console.log(`Installing module filename: ${this.filename}`),!(this.filename in window.r20esInstalledModuleTable)?(console.log("First run"),this.internalInstallFirstTime()):(this.filename in window.r20esDisposeTable&&console.error(`DUPLICATE MODULE FOUND: ${this.filename}`),console.log("Calling install update"),this.internalInstallUpdate()),window.r20esDisposeTable[this.filename]=(()=>{this.dispose()}),window.r20esInstalledModuleTable[this.filename]=this,console.log(`DONE! module ID: ${this.filename}`)},n}(),a.SimpleBase=function(n){function e(){return n.apply(this,arguments)||this}o(e,n);var t=e.prototype;return t.installFirstTime=function(){this.setup()},t.installUpdate=function(){this.setup()},t.setup=function(){},e}(a.Base),a.OnAppLoadBase=function(n){function e(e){var t;return(t=n.call(this,e)||this).setup=t.setup.bind(r(r(t))),t}o(e,n);var t=e.prototype;return t.installFirstTime=function(){window.r20es.isLoading?(this.earlySetup(),window.r20es.onAppLoad.addEventListener(this.setup)):(this.earlySetup(),this.setup())},t.earlySetup=function(){},t.setup=function(){},t.installUpdate=function(){this.installFirstTime()},t.dispose=function(){window.r20es.onAppLoad.removeEventListener(this.setup)},e}(a.Base),a.canInstall=(n=>window.r20es&&"canInstallModules"in window.r20es&&window.r20es.canInstallModules),a.getModule=function(n){return"r20esInstalledModuleTable"in window?window.r20esInstalledModuleTable[n]:null},a.getModuleById=function(n){return"r20esInstalledModuleTable"in window?a.getModule(window.r20es.hooks[n].filename):null}},5:function(n,e,t){"use strict";e.__esModule=!0;var i,r=t(7);!function(n){var e;function t(){return window.d20.engine.unselect()}function i(n){window.d20.engine.select(n)}function o(){return window.currentPlayer}function a(){return window.currentEditingLayer}function u(){try{var n=window.d20.Campaign.attributes.jukeboxfolder;return JSON.parse(n||"[]")}catch(n){console.error("[getJukeboxFileStructure] failed to get fs due to exception",n)}return[]}function l(n){return window.Jukebox.playlist.get(n)}function c(){return window.d20.Campaign.activePage()}function s(){return window.d20.engine.canvas.getObjects()}function f(e){for(var t=0,i=s();t<i.length;t++){var r=i[t],o=n.try_get_canvas_object_model(r);if(o&&o.get("id")===e)return r}return null}function d(n,e,t){t?($(document).on("mancerroll:"+e,function(n,i){$(document).off("mancerroll:"+e),t(n,i)}),window.d20.textchat.doChatInput(n,e)):window.d20.textchat.doChatInput(n)}function p(n){window.d20.textchat.incoming(!1,{who:"system",type:"system",content:n})}function g(){window.d20.engine.redrawScreenNextTick(!1)}!function(n){n[n.NumericAscending=0]="NumericAscending",n[n.NumericDescending=1]="NumericDescending",n[n.Alphabetical=2]="Alphabetical",n[n.AlphabeticalDescending=3]="AlphabeticalDescending",n[n.Card=4]="Card"}(e=n.InitiativeOrdering||(n.InitiativeOrdering={})),function(n){n.Map="map",n.PlayerTokens="objects",n.GMTokens="gmlayer",n.Lighting="walls",n.B20Foreground="foreground",n.B20Weather="weather"}(n.CanvasLayer||(n.CanvasLayer={})),n.setBackgroundStyle=function(n){window.d20.engine.backgroundColor=n},n.setupImageDropTarget=function(n,e,t){var i={model:{save:e},updateModel:t};window.d20.utils.setupAvatar(n,i)},n.getCanvasMousePos=function(){return window.d20.engine.mousePos.slice()},n.onInitiativeChange=function(e){return new r.EventSubscriber("change:turnorder",e,function(){return n.getInitiativeWindow().model})},n.setCanvasObjectLocation=function(e,t,i){var r=n.try_get_canvas_object_model(e);r&&r.save({top:i,left:t})},n.getBlob=function(n,e,t){return void 0===t&&(t=5e3),new Promise(function(i,r){n._getLatestBlob(e,i),setTimeout(r,t)})},n.getCampaign=function(){return window.Campaign},n.canEditCharacter=function(e){var t=e.attributes.controlledby;return!!n.isGM()||(!!t.includes("all")||!!t.includes(n.getCurrentPlayer().id))},n.getHandout=function(n){return window.Campaign.handouts.get(n)},n.createCharacter=function(n){return window.Campaign.characters.create(n)},n.setCanvasObjectDimensions=function(e,t,i){var r=n.try_get_canvas_object_model(e);r&&r.save({width:t,height:i})},n.getCharacter=function(n){return window.Campaign.characters.get(n)},n.getAllCharacters=function(){return window.Campaign.characters.models},n.getAllPages=function(){return window.Campaign.pages.models},n.createRollableTable=function(n){return window.d20.Campaign.rollabletables.create(n)},n.getRollableTable=function(n){return window.d20.Campaign.rollabletables.get(n)},n.getSelectedTokens=function(){return window.d20.engine.selected()},n.unselectTokens=t,n.addTokenToSelection=i,n.selectToken=function(n){t(),i(n)},n.hideTokenRadialMenu=function(){window.d20.token_editor.removeRadialMenu()},n.hideTokenContextMenu=function(){window.d20.token_editor.closeContextMenu()},n.getCurrentPlayer=o,n.getCanvasZoom=function(){return window.d20.engine.canvasZoom},n.getCanvasWidth=function(){return window.d20.engine.canvas.width},n.getCanvasHeight=function(){return window.d20.engine.canvas.height},n.getCanvasOffsetX=function(){return window.d20.engine.currentCanvasOffset[0]},n.getCanvasOffsetY=function(){return window.d20.engine.currentCanvasOffset[1]},n.getPageById=function(n){return window.Campaign.pages.get(n)},n.isGM=function(){return window.is_gm},n.getCurrentLayer=a,n.generateUUID=function(){return window.generateUUID()},n.getCurrentToolName=function(){return window.d20.engine.mode},n.advanceInitiative=function(){window.d20.Campaign.initiativewindow.nextTurn()},n.addTokenToInitiative=function(n){window.d20.Campaign.initiativewindow.addTokenToList(n)},n.addCustomItemToInitiative=function(n,e){window.d20.Campaign.initiativewindow.addTokenToList("-1",n,e)},n.rerenderMacroBar=function(){window.d20.player_settings.refreshMacroBar()},n.rerenderJournalMacros=function(){window.d20.player_settings.refreshRollsList()},n.orderInitiativeBy=function(n){var t,i=((t={})[e.NumericAscending]=".sortlist_numeric",t[e.NumericDescending]=".sortlist_numericdesc",t[e.Alphabetical]=".sortlist_alpha",t[e.AlphabeticalDescending]=".sortlist_alphadesc",t[e.Card]=".sortlist_card",t);if(n in i){var r=i[n];$("#initiativewindow_settings").dialog({modal:!1,title:"Turn Order Settings",beforeClose:function(){}}),$(r).click()}else console.error("Invalid initiative ordering: "+n)},n.getInitiativeWindow=function(){return window.d20.Campaign.initiativewindow},n.getJukeboxFileStructure=u,n.setJukeboxFileStructure=function(e){n.getCampaign().save({jukeboxfolder:JSON.stringify(e)})},n.createPlaylist=function(n){return window.d20.jukebox.addFolderToFolderStructure(n)},n.addTrackToPlaylist=function(n,e){return window.d20.jukebox.addItemToFolderStructure(n,e)},n.getSongById=l,n.getJukeboxPlaylists=function(){for(var n=[],e=0,t=u();e<t.length;e++){var i=t[e];if("string"!=typeof i){for(var r=i,o={id:r.id,name:r.n,mode:r.s,songs:[]},a=0,c=r.i;a<c.length;a++){var s=c[a],f=l(s);f?o.songs.push(f):console.warn("Tried to get song id "+s+" but the query returned a falsy value. Skipping")}n.push(o)}}return n},n.playAudio=function(n,e){window.Jukebox.soundObjs[n]=window.soundManager.createSound({id:n,url:e})},n.createSong=function(n){return window.Jukebox.playlist.create(n)},n.makePlaylistStructure=function(n,e,t){return{id:window.generateUUID(),n:n,s:e,i:t||[]}},n.getInitiativeData=function(){return window.d20.Campaign.initiativewindow.cleanList()},n.setInitiativeData=function(n){window.d20.Campaign.initiativewindow.model.save({turnorder:JSON.stringify(n)})},n.getCurrentPage=c,n.getCurrentPageTokens=s,n.doesTokenContainMouse=function(n,e){return window.d20.engine.canvas.containsPoint(n,e)},n.getCurrentPageTokenByUUID=f,n.try_get_canvas_object_model=function(n){return n._model?n._model:n.model?n.model:null},n.isUsing5EOGLSheet=function(){try{return window.d20.journal.customSheets.workerScripts[0].includes("5th Edition OGL by Roll20")}catch(n){return!1}},n.moveCameraToTokenByUUID=function(n){if(n){var e=f(n);if(e){var t=$("#editor-wrapper")[0];t.scrollTop=Math.floor(e.top*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasHeight/2)+125*window.d20.engine.canvasZoom,t.scrollLeft=Math.floor(e.left*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasWidth/2)+125*window.d20.engine.canvasZoom}}},n.primitiveSay=function(n,e){window.d20.textchat.doChatInput(n,e)},n.say=d,n.sayToSelf=function(e,t){var i='/w "'+o().get("displayname")+'" '+e;t?d(i,n.generateUUID(),t):d(i)},n.saySystemRaw=p,n.saySystem=function(n){p('<span style="background: rgba(6,26,45,255);\n    color: whitesmoke;\n    border: none;\n    display: inline-block;\n    padding: 8px;\n    margin: -15px -5px -7px -45px;    \n    "\n>\n'+n+"\n</span>\n        ")},n.ping=function(n,e,t,i,r){t=t||o().id,window.d20.engine.pings[t]={left:n,top:e,radius:-5,player:t,pageid:i||c().id,currentLayer:r||a()},window.d20.engine.pinging={downx:n,downy:e},g()},n.getFabric=function(){return window.exports.fabric},n.renderAll=g,n.setGMLayerOpacity=function(n){window.d20.engine.gm_layer_opacity=n},n.hasBetteR20=function(){return void 0!==window.d20plus},n.wipeObjectStorage=function(n){for(var e=n.length,t=0;t<e;t++){var i=n.length-1;if(0>i)break;var r=n.models[i];if(!r||void 0===r)break;r.destroy()}n.length<0&&console.error("FAILED TO WIPE OBJECT STORAGE!")},n.doBulkRoll=function(e,t,i,r,o){n.unselectTokens();var a=function(e){if(n.selectToken(e),o){var i=o(e);i&&n.say(t,i.id,i.callback)}else n.say(t)},u=function(){if(n.hideTokenRadialMenu(),n.hideTokenContextMenu(),r)for(var t=0,i=e;t<i.length;t++){var o=i[t];n.addTokenToSelection(o)}};if(0===i){for(var l=0,c=e;l<c.length;l++){var s=c[l];a(s)}u()}else for(var f=i,d=function(n){setTimeout(function(){a(e[n]),n+1===e.length&&u()},f),f+=i},p=0;p<e.length;p++)d(p)}}(i||(i={})),e.R20=i},7:function(n,e,t){"use strict";e.__esModule=!0;var i=function(){function n(n,e,t){this._isSubscribed=!1,this._name=n,this._callback=e,this._targetGetter=t}return n.subscribe=function(e,t,i){var r=new n(e,t,i);return r.subscribe(),r},n.prototype.subscribe=function(){if(!this._isSubscribed){var n=this._targetGetter();"on"in n?n.on(this._name,this._callback):n.addEventListener(this._name,this._callback),this._isSubscribed=!0}},n.prototype.unsubscribe=function(){if(this._isSubscribed){var n=this._targetGetter();"off"in n?n.off(this._name,this._callback):n.removeEventListener(this._name,this._callback),this._isSubscribed=!1}},n}();e.EventSubscriber=i},76:function(n,e,t){var i;(function(){var t=this,r=t._,o={},a=Array.prototype,u=Object.prototype,l=Function.prototype,c=a.push,s=a.slice,f=a.concat,d=u.toString,p=u.hasOwnProperty,g=a.forEach,h=a.map,v=a.reduce,w=a.reduceRight,y=a.filter,m=a.every,b=a.some,_=a.indexOf,k=a.lastIndexOf,I=Array.isArray,T=Object.keys,C=l.bind,x=function(n){return n instanceof x?n:this instanceof x?void(this._wrapped=n):new x(n)};void 0!==n&&n.exports&&(e=n.exports=x),e._=x,x.VERSION="1.6.0";var S=x.each=x.forEach=function(n,e,t){if(null==n)return n;if(g&&n.forEach===g)n.forEach(e,t);else if(n.length===+n.length){for(var i=0,r=n.length;i<r;i++)if(e.call(t,n[i],i,n)===o)return}else{var a=x.keys(n);for(i=0,r=a.length;i<r;i++)if(e.call(t,n[a[i]],a[i],n)===o)return}return n};x.map=x.collect=function(n,e,t){var i=[];return null==n?i:h&&n.map===h?n.map(e,t):(S(n,function(n,r,o){i.push(e.call(t,n,r,o))}),i)};var O="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(n,e,t,i){var r=arguments.length>2;if(null==n&&(n=[]),v&&n.reduce===v)return i&&(e=x.bind(e,i)),r?n.reduce(e,t):n.reduce(e);if(S(n,function(n,o,a){r?t=e.call(i,t,n,o,a):(t=n,r=!0)}),!r)throw new TypeError(O);return t},x.reduceRight=x.foldr=function(n,e,t,i){var r=arguments.length>2;if(null==n&&(n=[]),w&&n.reduceRight===w)return i&&(e=x.bind(e,i)),r?n.reduceRight(e,t):n.reduceRight(e);var o=n.length;if(o!==+o){var a=x.keys(n);o=a.length}if(S(n,function(u,l,c){l=a?a[--o]:--o,r?t=e.call(i,t,n[l],l,c):(t=n[l],r=!0)}),!r)throw new TypeError(O);return t},x.find=x.detect=function(n,e,t){var i;return M(n,function(n,r,o){if(e.call(t,n,r,o))return i=n,!0}),i},x.filter=x.select=function(n,e,t){var i=[];return null==n?i:y&&n.filter===y?n.filter(e,t):(S(n,function(n,r,o){e.call(t,n,r,o)&&i.push(n)}),i)},x.reject=function(n,e,t){return x.filter(n,function(n,i,r){return!e.call(t,n,i,r)},t)},x.every=x.all=function(n,e,t){e||(e=x.identity);var i=!0;return null==n?i:m&&n.every===m?n.every(e,t):(S(n,function(n,r,a){if(!(i=i&&e.call(t,n,r,a)))return o}),!!i)};var M=x.some=x.any=function(n,e,t){e||(e=x.identity);var i=!1;return null==n?i:b&&n.some===b?n.some(e,t):(S(n,function(n,r,a){if(i||(i=e.call(t,n,r,a)))return o}),!!i)};x.contains=x.include=function(n,e){return null!=n&&(_&&n.indexOf===_?-1!=n.indexOf(e):M(n,function(n){return n===e}))},x.invoke=function(n,e){var t=s.call(arguments,2),i=x.isFunction(e);return x.map(n,function(n){return(i?e:n[e]).apply(n,t)})},x.pluck=function(n,e){return x.map(n,x.property(e))},x.where=function(n,e){return x.filter(n,x.matches(e))},x.findWhere=function(n,e){return x.find(n,x.matches(e))},x.max=function(n,e,t){if(!e&&x.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);var i=-1/0,r=-1/0;return S(n,function(n,o,a){var u=e?e.call(t,n,o,a):n;u>r&&(i=n,r=u)}),i},x.min=function(n,e,t){if(!e&&x.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);var i=1/0,r=1/0;return S(n,function(n,o,a){var u=e?e.call(t,n,o,a):n;u<r&&(i=n,r=u)}),i},x.shuffle=function(n){var e,t=0,i=[];return S(n,function(n){e=x.random(t++),i[t-1]=i[e],i[e]=n}),i},x.sample=function(n,e,t){return null==e||t?(n.length!==+n.length&&(n=x.values(n)),n[x.random(n.length-1)]):x.shuffle(n).slice(0,Math.max(0,e))};var j=function(n){return null==n?x.identity:x.isFunction(n)?n:x.property(n)};x.sortBy=function(n,e,t){return e=j(e),x.pluck(x.map(n,function(n,i,r){return{value:n,index:i,criteria:e.call(t,n,i,r)}}).sort(function(n,e){var t=n.criteria,i=e.criteria;if(t!==i){if(t>i||void 0===t)return 1;if(t<i||void 0===i)return-1}return n.index-e.index}),"value")};var A=function(n){return function(e,t,i){var r={};return t=j(t),S(e,function(o,a){var u=t.call(i,o,a,e);n(r,u,o)}),r}};x.groupBy=A(function(n,e,t){x.has(n,e)?n[e].push(t):n[e]=[t]}),x.indexBy=A(function(n,e,t){n[e]=t}),x.countBy=A(function(n,e){x.has(n,e)?n[e]++:n[e]=1}),x.sortedIndex=function(n,e,t,i){for(var r=(t=j(t)).call(i,e),o=0,a=n.length;o<a;){var u=o+a>>>1;t.call(i,n[u])<r?o=u+1:a=u}return o},x.toArray=function(n){return n?x.isArray(n)?s.call(n):n.length===+n.length?x.map(n,x.identity):x.values(n):[]},x.size=function(n){return null==n?0:n.length===+n.length?n.length:x.keys(n).length},x.first=x.head=x.take=function(n,e,t){if(null!=n)return null==e||t?n[0]:e<0?[]:s.call(n,0,e)},x.initial=function(n,e,t){return s.call(n,0,n.length-(null==e||t?1:e))},x.last=function(n,e,t){if(null!=n)return null==e||t?n[n.length-1]:s.call(n,Math.max(n.length-e,0))},x.rest=x.tail=x.drop=function(n,e,t){return s.call(n,null==e||t?1:e)},x.compact=function(n){return x.filter(n,x.identity)};var D=function(n,e,t){return e&&x.every(n,x.isArray)?f.apply(t,n):(S(n,function(n){x.isArray(n)||x.isArguments(n)?e?c.apply(t,n):D(n,e,t):t.push(n)}),t)};x.flatten=function(n,e){return D(n,e,[])},x.without=function(n){return x.difference(n,s.call(arguments,1))},x.partition=function(n,e){var t=[],i=[];return S(n,function(n){(e(n)?t:i).push(n)}),[t,i]},x.uniq=x.unique=function(n,e,t,i){x.isFunction(e)&&(i=t,t=e,e=!1);var r=t?x.map(n,t,i):n,o=[],a=[];return S(r,function(t,i){(e?i&&a[a.length-1]===t:x.contains(a,t))||(a.push(t),o.push(n[i]))}),o},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(n){var e=s.call(arguments,1);return x.filter(x.uniq(n),function(n){return x.every(e,function(e){return x.contains(e,n)})})},x.difference=function(n){var e=f.apply(a,s.call(arguments,1));return x.filter(n,function(n){return!x.contains(e,n)})},x.zip=function(){for(var n=x.max(x.pluck(arguments,"length").concat(0)),e=new Array(n),t=0;t<n;t++)e[t]=x.pluck(arguments,""+t);return e},x.object=function(n,e){if(null==n)return{};for(var t={},i=0,r=n.length;i<r;i++)e?t[n[i]]=e[i]:t[n[i][0]]=n[i][1];return t},x.indexOf=function(n,e,t){if(null==n)return-1;var i=0,r=n.length;if(t){if("number"!=typeof t)return n[i=x.sortedIndex(n,e)]===e?i:-1;i=t<0?Math.max(0,r+t):t}if(_&&n.indexOf===_)return n.indexOf(e,t);for(;i<r;i++)if(n[i]===e)return i;return-1},x.lastIndexOf=function(n,e,t){if(null==n)return-1;var i=null!=t;if(k&&n.lastIndexOf===k)return i?n.lastIndexOf(e,t):n.lastIndexOf(e);for(var r=i?t:n.length;r--;)if(n[r]===e)return r;return-1},x.range=function(n,e,t){arguments.length<=1&&(e=n||0,n=0),t=arguments[2]||1;for(var i=Math.max(Math.ceil((e-n)/t),0),r=0,o=new Array(i);r<i;)o[r++]=n,n+=t;return o};var E=function(){};x.bind=function(n,e){var t,i;if(C&&n.bind===C)return C.apply(n,s.call(arguments,1));if(!x.isFunction(n))throw new TypeError;return t=s.call(arguments,2),i=function(){if(!(this instanceof i))return n.apply(e,t.concat(s.call(arguments)));E.prototype=n.prototype;var r=new E;E.prototype=null;var o=n.apply(r,t.concat(s.call(arguments)));return Object(o)===o?o:r}},x.partial=function(n){var e=s.call(arguments,1);return function(){for(var t=0,i=e.slice(),r=0,o=i.length;r<o;r++)i[r]===x&&(i[r]=arguments[t++]);for(;t<arguments.length;)i.push(arguments[t++]);return n.apply(this,i)}},x.bindAll=function(n){var e=s.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return S(e,function(e){n[e]=x.bind(n[e],n)}),n},x.memoize=function(n,e){var t={};return e||(e=x.identity),function(){var i=e.apply(this,arguments);return x.has(t,i)?t[i]:t[i]=n.apply(this,arguments)}},x.delay=function(n,e){var t=s.call(arguments,2);return setTimeout(function(){return n.apply(null,t)},e)},x.defer=function(n){return x.delay.apply(x,[n,1].concat(s.call(arguments,1)))},x.throttle=function(n,e,t){var i,r,o,a=null,u=0;t||(t={});var l=function(){u=!1===t.leading?0:x.now(),a=null,o=n.apply(i,r),i=r=null};return function(){var c=x.now();u||!1!==t.leading||(u=c);var s=e-(c-u);return i=this,r=arguments,s<=0?(clearTimeout(a),a=null,u=c,o=n.apply(i,r),i=r=null):a||!1===t.trailing||(a=setTimeout(l,s)),o}},x.debounce=function(n,e,t){var i,r,o,a,u,l=function(){var c=x.now()-a;c<e?i=setTimeout(l,e-c):(i=null,t||(u=n.apply(o,r),o=r=null))};return function(){o=this,r=arguments,a=x.now();var c=t&&!i;return i||(i=setTimeout(l,e)),c&&(u=n.apply(o,r),o=r=null),u}},x.once=function(n){var e,t=!1;return function(){return t?e:(t=!0,e=n.apply(this,arguments),n=null,e)}},x.wrap=function(n,e){return x.partial(e,n)},x.compose=function(){var n=arguments;return function(){for(var e=arguments,t=n.length-1;t>=0;t--)e=[n[t].apply(this,e)];return e[0]}},x.after=function(n,e){return function(){if(--n<1)return e.apply(this,arguments)}},x.keys=function(n){if(!x.isObject(n))return[];if(T)return T(n);var e=[];for(var t in n)x.has(n,t)&&e.push(t);return e},x.values=function(n){for(var e=x.keys(n),t=e.length,i=new Array(t),r=0;r<t;r++)i[r]=n[e[r]];return i},x.pairs=function(n){for(var e=x.keys(n),t=e.length,i=new Array(t),r=0;r<t;r++)i[r]=[e[r],n[e[r]]];return i},x.invert=function(n){for(var e={},t=x.keys(n),i=0,r=t.length;i<r;i++)e[n[t[i]]]=t[i];return e},x.functions=x.methods=function(n){var e=[];for(var t in n)x.isFunction(n[t])&&e.push(t);return e.sort()},x.extend=function(n){return S(s.call(arguments,1),function(e){if(e)for(var t in e)n[t]=e[t]}),n},x.pick=function(n){var e={},t=f.apply(a,s.call(arguments,1));return S(t,function(t){t in n&&(e[t]=n[t])}),e},x.omit=function(n){var e={},t=f.apply(a,s.call(arguments,1));for(var i in n)x.contains(t,i)||(e[i]=n[i]);return e},x.defaults=function(n){return S(s.call(arguments,1),function(e){if(e)for(var t in e)void 0===n[t]&&(n[t]=e[t])}),n},x.clone=function(n){return x.isObject(n)?x.isArray(n)?n.slice():x.extend({},n):n},x.tap=function(n,e){return e(n),n};var R=function(n,e,t,i){if(n===e)return 0!==n||1/n==1/e;if(null==n||null==e)return n===e;n instanceof x&&(n=n._wrapped),e instanceof x&&(e=e._wrapped);var r=d.call(n);if(r!=d.call(e))return!1;switch(r){case"[object String]":return n==String(e);case"[object Number]":return n!=+n?e!=+e:0==n?1/n==1/e:n==+e;case"[object Date]":case"[object Boolean]":return+n==+e;case"[object RegExp]":return n.source==e.source&&n.global==e.global&&n.multiline==e.multiline&&n.ignoreCase==e.ignoreCase}if("object"!=typeof n||"object"!=typeof e)return!1;for(var o=t.length;o--;)if(t[o]==n)return i[o]==e;var a=n.constructor,u=e.constructor;if(a!==u&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(u)&&u instanceof u)&&"constructor"in n&&"constructor"in e)return!1;t.push(n),i.push(e);var l=0,c=!0;if("[object Array]"==r){if(c=(l=n.length)==e.length)for(;l--&&(c=R(n[l],e[l],t,i)););}else{for(var s in n)if(x.has(n,s)&&(l++,!(c=x.has(e,s)&&R(n[s],e[s],t,i))))break;if(c){for(s in e)if(x.has(e,s)&&!l--)break;c=!l}}return t.pop(),i.pop(),c};x.isEqual=function(n,e){return R(n,e,[],[])},x.isEmpty=function(n){if(null==n)return!0;if(x.isArray(n)||x.isString(n))return 0===n.length;for(var e in n)if(x.has(n,e))return!1;return!0},x.isElement=function(n){return!(!n||1!==n.nodeType)},x.isArray=I||function(n){return"[object Array]"==d.call(n)},x.isObject=function(n){return n===Object(n)},S(["Arguments","Function","String","Number","Date","RegExp"],function(n){x["is"+n]=function(e){return d.call(e)=="[object "+n+"]"}}),x.isArguments(arguments)||(x.isArguments=function(n){return!(!n||!x.has(n,"callee"))}),x.isFunction=function(n){return"function"==typeof n},x.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},x.isNaN=function(n){return x.isNumber(n)&&n!=+n},x.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"==d.call(n)},x.isNull=function(n){return null===n},x.isUndefined=function(n){return void 0===n},x.has=function(n,e){return p.call(n,e)},x.noConflict=function(){return t._=r,this},x.identity=function(n){return n},x.constant=function(n){return function(){return n}},x.property=function(n){return function(e){return e[n]}},x.matches=function(n){return function(e){if(e===n)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0}},x.times=function(n,e,t){for(var i=Array(Math.max(0,n)),r=0;r<n;r++)i[r]=e.call(t,r);return i},x.random=function(n,e){return null==e&&(e=n,n=0),n+Math.floor(Math.random()*(e-n+1))},x.now=Date.now||function(){return(new Date).getTime()};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};F.unescape=x.invert(F.escape);var P={escape:new RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(n){x[n]=function(e){return null==e?"":(""+e).replace(P[n],function(e){return F[n][e]})}}),x.result=function(n,e){if(null!=n){var t=n[e];return x.isFunction(t)?t.call(n):t}},x.mixin=function(n){S(x.functions(n),function(e){var t=x[e]=n[e];x.prototype[e]=function(){var n=[this._wrapped];return c.apply(n,arguments),J.call(this,t.apply(x,n))}})};var B=0;x.uniqueId=function(n){var e=++B+"";return n?n+e:e},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(n,e,t){var i;t=x.defaults({},t,x.templateSettings);var r=new RegExp([(t.escape||L).source,(t.interpolate||L).source,(t.evaluate||L).source].join("|")+"|$","g"),o=0,a="__p+='";n.replace(r,function(e,t,i,r,u){return a+=n.slice(o,u).replace(U,function(n){return"\\"+N[n]}),t&&(a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'"),i&&(a+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(a+="';\n"+r+"\n__p+='"),o=u+e.length,e}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(t.variable||"obj","_",a)}catch(n){throw n.source=a,n}if(e)return i(e,x);var u=function(n){return i.call(this,n,x)};return u.source="function("+(t.variable||"obj")+"){\n"+a+"}",u},x.chain=function(n){return x(n).chain()};var J=function(n){return this._chain?x(n).chain():n};x.mixin(x),S(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var e=a[n];x.prototype[n]=function(){var t=this._wrapped;return e.apply(t,arguments),"shift"!=n&&"splice"!=n||0!==t.length||delete t[0],J.call(this,t)}}),S(["concat","join","slice"],function(n){var e=a[n];x.prototype[n]=function(){return J.call(this,e.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),void 0===(i=function(){return x}.apply(e,[]))||(n.exports=i)}).call(this)}});