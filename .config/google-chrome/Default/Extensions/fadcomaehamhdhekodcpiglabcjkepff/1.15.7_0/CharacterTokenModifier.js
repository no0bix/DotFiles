!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=110)}({110:function(e,t,n){"use strict";(function(e){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};t.__esModule=!0;var a=n(4),l=n(2),s=n(22),c=n(5),u=n(6),d=n(73),p=n(12),m=function(e){var t=e.defaultVal,n=void 0===t?void 0:t,r=e.propName,o=e.token,a=e.label,s=e.wrapperStyle,c=void 0===s?{}:s;return l.DOM.createElement("span",{style:i({display:"inline-flex",alignItems:"center"},c)},l.DOM.createElement(_,{defaultVal:n,style:{marginRight:"4px"},propName:r,type:"checkbox",token:o}),l.DOM.createElement("span",null,a))},f=function(e){var t=e.tokenAttribs,n=e.name,r=e.index,i="aura"+r+"_radius",o="aura"+r+"_color",a="aura"+r+"_square";return l.DOM.createElement("div",{className:"inlineinputs",style:{display:"flex",alignItems:"center",marginTop:"5px"}},l.DOM.createElement("b",null,n),l.DOM.createElement(_,{propName:i,type:"text",token:t}),l.DOM.createElement("span",{style:{marginRight:"16px"}},"ft."),l.DOM.createElement("span",{style:{marginRight:"16px"}},l.DOM.createElement(k,{propName:o,token:t})),l.DOM.createElement(m,{label:"Square",propName:a,token:t}))},h=function(e){var t=e.name,n=e.color,r=e.character,i=e.tokenAttribs,o=e.index,a=e.onChange,s=r,c="bar"+o+"_value",u="bar"+o+"_max",p="bar"+o+"_link",m="You can only edit the current and max values when the bar is not linked.",f=l.DOM.createElement(_,{title:m,propName:c,type:"text",token:i}),h=l.DOM.createElement(_,{title:m,propName:u,type:"text",token:i}),g=i[p],b=function(e){var t=s.attribs.get(e);if(!e||!t)return f.disabled=!1,h.disabled=!1,w.value="",void y(w,"");f.disabled=!0,h.disabled=!0,g=e,w.value=t.attributes.name,y(w,t.id),f.value=t.attributes.current,h.value=t.attributes.max,a({target:f}),a({target:h})},w=l.DOM.createElement("input",{type:"text",style:{flex:"1"},placeholder:"Search for attribute"}),k=s.attribs.models.sort(function(e,t){return d.default(e,t,function(e){return e.attributes.name})}).map(function(e){return{value:e.id,label:e.attributes.name}});return $(w).autocomplete({minLength:1,delay:0,source:k,change:function(e,t){var n=t&&t.item&&t.item.value||void 0;b(n)},focus:function(e,t){e.preventDefault(),b(t.item.value)},select:function(e,t){e.preventDefault(),b(t.item.value)}}),$(w).blur(function(){""===w.value.trim()&&b(void 0)}),$(w).change(function(){""===w.value.trim()&&b(void 0)}),v(w,p),b(g),l.DOM.createElement("div",{className:"inlineinputs",style:{marginTop:"5px",marginBottom:"5px",display:"flex",alignItems:"center"}},l.DOM.createElement("b",null,t,l.DOM.createElement("span",{className:"bar_color_indicator",style:{marginLeft:"4px",display:"inline-block",width:"15px",height:"15px",borderRadius:"10px",backgroundColor:n}})),w,f,"/",h)},g=function(e){var t=e.name,n=e.tokenAttribs,r=e.propName,i=e.add_permissions,o=e.index,a="showplayers_"+r,s="playersedit_"+r,c=null;if(i){var u="bar"+(void 0===o?0:o)+"_num_permission";(c=l.DOM.createElement(_,{style:{margin:"0",marginLeft:"8px"},Component:"select",propName:u,token:n,defaultVal:"editors"},l.DOM.createElement("option",{value:"hidden"},"Hidden"),l.DOM.createElement("option",{value:"editors"},"Visible to Editors"),l.DOM.createElement("option",{value:"everyone"},"Visible to Everyone"))).value=n[u]||"editors",console.log("=============",n)}return l.DOM.createElement("div",{className:"inlineinputs",style:{height:"40px",display:"flex",alignItems:"center"}},l.DOM.createElement("b",{style:{display:"inline-block",width:"60px"}},t),l.DOM.createElement(m,{label:"See",defaultVal:!1,propName:a,token:n,wrapperStyle:{marginRight:"16px"}}),l.DOM.createElement(m,{label:"Edit",defaultVal:!0,propName:s,token:n}),c)},v=function(e,t){e.setAttribute(w,t)},b="data-token-value-override",y=function(e,t){e.setAttribute(b,t)},w="data-token-prop-name",_=function(e){var t=e.Component,n=void 0===t?"input":t,r=e.type,a=void 0===r?void 0:r,s=e.token,c=e.propName,u=e.defaultVal,d=o(e,["Component","type","token","propName","defaultVal"]),p=s,m=l.DOM.createElement(n,i({},d));a&&(m.type=a),v(m,c);var f=null,h=null;if("select"===n||"number"===a||"color"===a||"text"===a?(f="value",h=""):"checkbox"===a?(f="checked",h=!1):console.error("Unknown input type "+a),f){var g=p[c],b=null;b=void 0===g?void 0===u?h:u:g,"number"===a&&(b=parseInt(b,10)||0),console.log(c,f,b),m[f]=b}return m},k=function(e){var t=e.propName,n=e.token,r=l.DOM.createElement(_,{propName:t,type:"color",token:n}),i=l.DOM.createElement("button",{onClick:function(e){e.stopPropagation(),r.value=e.target.value},value:"transparent",className:"btn"},"Clear");return v(i,t),l.DOM.createElement("span",{style:{display:"inline-grid",gridTemplateColumns:"4fr 1fr"}},r,i)},O=function(e){var t=e.tokenAttribs;return l.DOM.createElement("div",{className:"span6"},l.DOM.createElement("h4",null,"Light Emitter"),l.DOM.createElement("div",{className:"inlineinputs",style:"margin-bottom: 16px;"},l.DOM.createElement(_,{propName:"light_radius",type:"text",token:t}),"ft.",l.DOM.createElement(_,{propName:"light_dimradius",type:"text",token:t}),"ft.",l.DOM.createElement(_,{propName:"light_angle",type:"text",token:t}),l.DOM.createElement("span",{style:"font-size: 2.0em;"},"°"),l.DOM.createElement("div",{style:"color: #888; padding-left: 5px; margin-bottom: 8px"},"Light Radius / (optional) Start of Dim / Angle"),l.DOM.createElement("div",{style:"margin-left: 7px;"},l.DOM.createElement(_,{propName:"light_otherplayers",type:"checkbox",style:{marginRight:"8px"},token:t}),"Is emitting light?")),l.DOM.createElement("div",{style:{display:"grid",gridTemplateColumns:"auto auto"}},l.DOM.createElement("div",null,l.DOM.createElement("h4",null,"Light Observer"),l.DOM.createElement("div",{className:"inlineinputs",style:"margin-bottom: 16px;"},l.DOM.createElement(_,{propName:"light_losangle",type:"text",placeholder:"360",token:t}),l.DOM.createElement("span",{style:"font-size: 2.0em;"},"°"),l.DOM.createElement(_,{propName:"light_multiplier",type:"number",placeholder:"1.0",token:t,style:{width:"40px",display:"inline-block",margin:"0px 5px"}}),l.DOM.createElement("div",{style:"color: #888; padding-left: 5px; margin-bottom: 8px"},"Angle / Multiplier"),l.DOM.createElement("div",{style:"margin-left: 7px;"},l.DOM.createElement(_,{propName:"light_hassight",type:"checkbox",style:{marginRight:"8px"},token:t}),"Can see?"))),l.DOM.createElement("div",null,l.DOM.createElement("h4",null,"Advanced Fog of War"),l.DOM.createElement("div",{className:"inlineinputs",style:"margin-top: 5px; margin-bottom: 16px;"},l.DOM.createElement(_,{propName:"adv_fow_view_distance",type:"text",token:t}),l.DOM.createElement("div",{style:"color: #888; padding-left: 5px;"},"View Distance")))))},M=function(){return function(){this.token=null,this.char=null}}(),E="/images/character.png",x=function(t){function n(){var n=t.call(this,e)||this;return n.sheetTab=null,n.onShowTab=function(e){var t=n.getUserData(e);console.log("show"),t.token&&t.char||(t.char=e.tryGetPc(),console.log(t),t.char&&c.R20.getBlob(t.char,"defaulttoken").then(function(e){if(u.strIsNullOrEmpty(e)){var n={imgsrc:t.char.attributes.avatar||E,height:70,width:70,name:t.char.attributes.name,represents:t.char.id};t.token=n}else{var r=JSON.parse(e);for(var i in t.token={represents:r.represents,name:r.name,imgsrc:r.imgsrc,showname:r.showname,tint_color:r.tint_color,width:r.width,height:r.height,light_radius:r.light_radius,light_dimradius:r.light_dimradius,light_angle:r.light_angle,light_otherplayers:r.light_otherplayers,light_losangle:r.light_losangle,light_multiplier:r.light_multiplier,light_hassight:r.light_hassight,adv_fow_view_distance:r.adv_fow_view_distance,bar1_link:r.bar1_link,bar1_max:r.bar1_max,bar1_value:r.bar1_value,bar2_link:r.bar2_link,bar2_max:r.bar2_max,bar2_value:r.bar2_value,bar3_link:r.bar3_link,bar3_max:r.bar3_max,bar3_value:r.bar3_value,aura1_color:r.aura1_color,aura1_radius:r.aura1_radius,aura1_square:r.aura1_square,aura2_color:r.aura2_color,aura2_radius:r.aura2_radius,aura2_square:r.aura2_square,showplayers_name:r.showplayers_name,playersedit_name:r.playersedit_name,showplayers_bar1:r.showplayers_bar1,playersedit_bar1:r.playersedit_bar1,showplayers_bar2:r.showplayers_bar2,playersedit_bar2:r.playersedit_bar2,showplayers_bar3:r.showplayers_bar3,playersedit_bar3:r.playersedit_bar3,showplayers_aura1:r.showplayers_aura1,playersedit_aura1:r.playersedit_aura1,showplayers_aura2:r.showplayers_aura2,playersedit_aura2:r.playersedit_aura2,bar1_num_permission:r.bar1_num_permission,bar2_num_permission:r.bar2_num_permission,bar3_num_permission:r.bar3_num_permission,bar_location:r.bar_location},t.token)void 0!==t.token[i]&&null!==t.token[i]||delete t.token[i]}}).finally(function(){e.rerender()}))},n.renderWidget=function(e){var t=c.R20.getCampaign().attributes,r=n.getUserData(e);if(!r.char)return l.DOM.createElement("div",null,"Could not find character. You might not have permissions to do so.");if(!r.token)return l.DOM.createElement("div",null,"Failed to get default token. You might not have permissions to do so.");var o={marginTop:"16px",marginLeft:"16px"},a=function(e){e.stopPropagation&&e.stopPropagation();var t=e.target,n=t.getAttribute(w);if(n){var i=t.value;switch(t.type){case"checkbox":i=t.checked;break;case"number":i=parseInt(t.value,10)}var o=t.getAttribute(b);o&&(i=o),console.log("Change: "+n+" -> "+i),r.token[n]=i}},s=l.DOM.createElement("button",{onClick:function(t){t.stopPropagation(),confirm("You will lose any unsaved changes. Proceed?")&&(r.char=null,r.token=null,n.onShowTab(e))},className:"btn"},"Refresh"),u=l.DOM.createElement("button",{onClick:function(){v();var e=i({},r.token);e.bar1_link&&delete e.bar1_value,e.bar2_link&&delete e.bar2_value,e.bar3_link&&delete e.bar3_value;var t=JSON.stringify(e);console.log(e),r.char.updateBlobs({defaulttoken:t}),r.char.save({defaulttoken:(new Date).getTime()}),y()},className:"btn"},"Update default token"),d=l.DOM.createElement("span",{style:{marginLeft:"auto",marginRight:"auto"}}),v=function(){d.innerText="Saving..."},y=function(){d.innerText="Done!"};if(c.R20.isGM())u.classList.add("btn-primary"),s.classList.add("btn-danger");else{var M=function(e){$(e).tipsy({live:p.isChromium()})};u.title="Players do not have permission to update the default token but they can update already placed tokens. Try updating all tokens.",u.disabled=!0,M(u),s.title="Players do not have permissions to read default character tokens.",s.disabled=!0,M(s)}var x="1px solid lightgray",D=l.DOM.createElement("div",null,l.DOM.createElement("h3",{style:{marginBottom:"16px"}},"Token Editor"),l.DOM.createElement("div",{style:{borderBottom:x}}),l.DOM.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"}},l.DOM.createElement("div",{style:{borderBottom:x}},l.DOM.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"}},l.DOM.createElement("div",{onDrop:function(t){var n=void 0,i=null;try{var o=t.dataTransfer.getData("text/html");n=/src="?([^"\s]+)"?\s*/.exec(o)[1]}catch(e){i=e}null!==n&&void 0!==n||(n=t.url),n?(r.token.imgsrc=n,e.rerender()):alert("Drag & Drop image failed: "+i)},className:"r20es-token-img-hover",style:{margin:"16px",position:"relative"}},l.DOM.createElement("div",{className:"r20es-hover-block",style:{position:"absolute",bottom:"0",right:"0",left:"0",top:"0"}},l.DOM.createElement("button",{onClick:function(t){t.stopPropagation(),r.token.imgsrc=E,e.rerender()},className:"btn",style:{marginBottom:"8px"}},"Remove Image"),l.DOM.createElement("button",{style:{marginBottom:"8px"},onClick:function(t){t.stopPropagation();var n=prompt("Image URL.","www.example.com/image.png");n&&(r.token.imgsrc=n,e.rerender())},className:"btn"},"Set from URL"),l.DOM.createElement("div",{style:{backgroundColor:"rgba(255,255,255,0.5)"}},"Drag an image on me!")),l.DOM.createElement("img",{style:{width:"100%"},src:r.token.imgsrc,alt:"token image"})),l.DOM.createElement("div",{style:{marginRight:"16px"}},l.DOM.createElement("div",null,"Name"),l.DOM.createElement("div",{style:{display:"flex"}},l.DOM.createElement(_,{propName:"name",type:"text",style:{width:"210px"},token:r.token}),l.DOM.createElement("button",{onClick:function(e){v(),r.char.save({name:r.token.name});var t=r.char.attribs.find(function(e){return"npc_name"===e.attributes.name});t&&t.save({current:r.token.name}),y()},className:"btn",title:"Updates the name of the character on the sheet with the name in the input box."},"Set")),l.DOM.createElement("div",null,l.DOM.createElement(_,{propName:"showname",type:"checkbox",style:{marginTop:"8px",marginRight:"4px"},token:r.token}),l.DOM.createElement("span",null,"Show nameplate?")),l.DOM.createElement("div",null,"Tint Color"),l.DOM.createElement(k,{style:{marginBottom:"8px"},propName:"tint_color",token:r.token}))),l.DOM.createElement("div",{style:{marginBottom:"4px"}},l.DOM.createElement("span",{style:{display:"inline-block",marginRight:"4px"}},"Width (px)"),l.DOM.createElement(_,{propName:"width",style:{width:"48px",marginRight:"12px"},type:"number",token:r.token}),l.DOM.createElement("span",{style:{display:"inline-block",marginRight:"4px"}},"Height (px)"),l.DOM.createElement(_,{propName:"height",style:{width:"48px"},type:"number",token:r.token})),l.DOM.createElement("div",{style:{marginBottom:"4px"}},l.DOM.createElement("span",{style:{display:"inline-block",marginRight:"4px"}},"Rotation (angles)"),l.DOM.createElement(_,{propName:"rotation",type:"number",token:r.token})),l.DOM.createElement("div",null,l.DOM.createElement(m,{label:"Flip Horizontal",defaultVal:!1,propName:"fliph",token:r.token,wrapperStyle:{marginRight:"16px"}}),l.DOM.createElement(m,{label:"Flip Vertical",defaultVal:!1,propName:"flipv",token:r.token})),l.DOM.createElement("hr",null),l.DOM.createElement(O,{tokenAttribs:r.token})),l.DOM.createElement("div",{style:{borderBottom:x,borderLeft:x}},l.DOM.createElement("div",{style:o},l.DOM.createElement(h,{name:"Bar 1",color:t.bar1_color,tokenAttribs:r.token,character:r.char,onChange:a,index:1}),l.DOM.createElement(h,{name:"Bar 2",color:t.bar2_color,tokenAttribs:r.token,character:r.char,onChange:a,index:2}),l.DOM.createElement(h,{name:"Bar 3",color:t.bar3_color,tokenAttribs:r.token,character:r.char,onChange:a,index:3})),l.DOM.createElement("hr",null),l.DOM.createElement("div",{style:o},l.DOM.createElement(f,{name:"Aura 1",tokenAttribs:r.token,index:1}),l.DOM.createElement(f,{name:"Aura 2",tokenAttribs:r.token,index:2})),l.DOM.createElement("hr",null),l.DOM.createElement("div",{style:Object.assign({},o,{marginBottom:"16px"})},l.DOM.createElement(g,{name:"Name",propName:"name",tokenAttribs:r.token,add_permissions:!1}),l.DOM.createElement(g,{name:"Bar 1",propName:"bar1",tokenAttribs:r.token,add_permissions:!0,index:1}),l.DOM.createElement(g,{name:"Bar 2",propName:"bar2",tokenAttribs:r.token,add_permissions:!0,index:2}),l.DOM.createElement(g,{name:"Bar 3",propName:"bar3",tokenAttribs:r.token,add_permissions:!0,index:3}),l.DOM.createElement(g,{name:"Aura 1",propName:"aura1",tokenAttribs:r.token,add_permissions:!1}),l.DOM.createElement(g,{name:"Aura 2",propName:"aura2",tokenAttribs:r.token,add_permissions:!1}),l.DOM.createElement("div",null,l.DOM.createElement("b",null,"Bar Location"),l.DOM.createElement(_,{style:{margin:"0",marginLeft:"8px"},Component:"select",propName:"bar_location",token:r.token,defaultVal:"above"},l.DOM.createElement("option",{value:"above"},"Above"),l.DOM.createElement("option",{value:"overlap_top"},"Top Overlapping"),l.DOM.createElement("option",{value:"overlap_bottom"},"Bottom Overlapping"),l.DOM.createElement("option",{value:"below"},"Below")))))),l.DOM.createElement("div",{style:{marginTop:"16px",marginBottom:"16px",display:"grid",gridTemplateColumns:"1fr 1fr 1fr"}},l.DOM.createElement("span",{style:"float: left"},s),d,l.DOM.createElement("span",{style:"float: right"},l.DOM.createElement("button",{onClick:function(e){if(e.stopPropagation(),confirm("Are you sure you want to do this? This will update ALL tokens in this campaign that represent this character.If you have changed the avatar, a refresh is required to see the changes.")){console.log(r.token),v();for(var t=0,n=c.R20.getAllPages();t<n.length;t++){var i=n[t];if(i.thegraphics)for(var o=0,a=i.thegraphics.models;o<a.length;o++){var l=a[o];l.character&&l.character.id===r.char.id&&l.save(r.token)}}y()}},style:"margin-right: 8px",className:"btn btn-info"},"Update all tokens"),u)));return $(D).find("input, select, button").on("change",a).on("click",a),c.R20.setupImageDropTarget($(D).find(".r20es-token-img-hover"),function(e){var t=e.avatar;console.log(t),r.token.imgsrc=t},function(){setTimeout(function(){console.log("rerender"),e.rerender()},100)}),D},n.setup=function(){n.sheetTab=s.SheetTab.add("Token Editor",n.renderWidget,n.onShowTab,c.R20.canEditCharacter)},n.dispose=function(){t.prototype.dispose.call(n),n.sheetTab&&n.sheetTab.dispose()},n}return r(n,t),n.prototype.getUserData=function(e){return e.userData||(e.userData=new M),e.userData},n}(a.R20Module.OnAppLoadBase);a.R20Module.canInstall()&&(new x).install()}).call(this,"src/modules/CharacterTokenModifier")},12:function(e,t,n){"use strict";t.__esModule=!0;var r=n(13),i=function(){var e=r.default();return"chrome"===e.name||"opera"===e.name};t.isChromium=i;t.doesBrowserNotSupportResponseFiltering=function(){var e=r.default();return console.log(e),!!i()||"firefox"===e.name&&e.versionNumber<57}},13:function(e,t,n){"use strict";n.r(t),function(e){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r=[["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["edge",/Edge\/([0-9\._]+)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+)\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["safari",/Version\/([0-9\._]+).*Safari/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/]],i=["Windows Phone","Android","CentOS",{name:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],o={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},a=new RegExp(["(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|","compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|","midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)","\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|","wap|windows ce|xda|xiino"].join(""),"i"),l=new RegExp(["1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|","ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|","avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|","cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|","ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|","g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|","hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|","i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|","kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])","|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|","mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|","n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|","op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|","po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|","raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|","se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|k\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|","so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|","tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|","veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|","w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-"].join(""),"i"),s=function(){function e(e,t,n){this.navigator=t,this.process=n,this.userAgent=e||(this.navigator?t.userAgent||t.vendor:"")}return e.prototype.detect=function(){if(this.process&&!this.userAgent){var e=this.process.version.slice(1).split(".").slice(0,3),t=Array.prototype.slice.call(e,1).join("")||"0";return{name:"node",version:e.join("."),versionNumber:parseFloat(e[0]+"."+t),mobile:!1,os:this.process.platform}}return this.userAgent||this.handleMissingError(),n({},this.checkBrowser(),this.checkMobile(),this.checkOs())},e.prototype.checkBrowser=function(){var e=this;return r.filter(function(t){return t[1].test(e.userAgent)}).map(function(t){var n=t[1].exec(e.userAgent),r=n&&n[1].split(/[._]/).slice(0,3),i=Array.prototype.slice.call(r,1).join("")||"0";return r&&r.length<3&&Array.prototype.push.apply(r,1===r.length?[0,0]:[0]),{name:String(t[0]),version:r.join("."),versionNumber:Number(r[0]+"."+i)}}).shift()},e.prototype.checkMobile=function(){var e=this.userAgent.substr(0,4);return{mobile:a.test(this.userAgent)||l.test(e)}},e.prototype.checkOs=function(){var e=this;return i.map(function(t){var n=t.name||t,r=e.getOsPattern(t);return{name:n,pattern:r,value:RegExp("\\b"+r.replace(/([ -])(?!$)/g,"$1?")+"(?:x?[\\d._]+|[ \\w.]*)","i").exec(e.userAgent)}}).filter(function(e){return e.value}).map(function(e){var t,n=e.value[0]||"";return e.pattern&&e.name&&/^Win/i.test(n)&&!/^Windows Phone /i.test(n)&&(t=o[n.replace(/[^\d.]/g,"")])&&(n="Windows "+t),e.pattern&&e.name&&(n=n.replace(RegExp(e.pattern,"i"),e.name)),n=n.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0].trim(),{os:n=/^(?:webOS|i(?:OS|P))/.test(n)?n:n.charAt(0).toUpperCase()+n.slice(1)}}).shift()},e.prototype.getOsPattern=function(e){var t=e;return("string"==typeof e?e:void 0)||t.pattern||t.name},e.prototype.handleMissingError=function(){throw new Error("Please give user-agent.\n> browser(navigator.userAgent or res.headers['user-agent']).")},e}();function c(e,t){return e(t={exports:{}},t.exports),t.exports}var u=c(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),d=c(function(e){var t=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=t)}),p=(d.version,function(e){return"object"==typeof e?null!==e:"function"==typeof e}),m=function(e){if(!p(e))throw TypeError(e+" is not an object!");return e},f=function(e){try{return!!e()}catch(e){return!0}},h=!f(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),g=u.document,v=p(g)&&p(g.createElement),b=!h&&!f(function(){return 7!=Object.defineProperty(function(e){return v?g.createElement(e):{}}("div"),"a",{get:function(){return 7}}).a}),y=Object.defineProperty,w={f:h?Object.defineProperty:function(e,t,n){if(m(e),t=function(e,t){if(!p(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!p(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!p(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!p(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}(t,!0),m(n),b)try{return y(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},_=h?function(e,t,n){return w.f(e,t,function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}(1,n))}:function(e,t,n){return e[t]=n,e},k={}.hasOwnProperty,O=function(e,t){return k.call(e,t)},M=0,E=Math.random(),x=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++M+E).toString(36))},D=c(function(e){var t=x("src"),n=Function.toString,r=(""+n).split("toString");d.inspectSource=function(e){return n.call(e)},(e.exports=function(e,n,i,o){var a="function"==typeof i;a&&(O(i,"name")||_(i,"name",n)),e[n]!==i&&(a&&(O(i,t)||_(i,t,e[n]?""+e[n]:r.join(String(n)))),e===u?e[n]=i:o?e[n]?e[n]=i:_(e,n,i):(delete e[n],_(e,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||n.call(this)})}),T=function(e,t,n){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},S=function(e,t,n){var r,i,o,a,l=e&S.F,s=e&S.G,c=e&S.S,p=e&S.P,m=e&S.B,f=s?u:c?u[t]||(u[t]={}):(u[t]||{}).prototype,h=s?d:d[t]||(d[t]={}),g=h.prototype||(h.prototype={});for(r in s&&(n=t),n)o=((i=!l&&f&&void 0!==f[r])?f:n)[r],a=m&&i?T(o,u):p&&"function"==typeof o?T(Function.call,o):o,f&&D(f,r,o,e&S.U),h[r]!=o&&_(h,r,a),p&&g[r]!=o&&(g[r]=o)};u.core=d,S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128;var C=S,A={}.toString,N=function(e){return A.call(e).slice(8,-1)},I=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==N(e)?e.split(""):Object(e)},P=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},R=Math.ceil,j=Math.floor,B=Math.min,L=function(e){return e>0?B(function(e){return isNaN(e=+e)?0:(e>0?j:R)(e)}(e),9007199254740991):0},U=Array.isArray||function(e){return"Array"==N(e)},F=c(function(e){var t=u["__core-js_shared__"]||(u["__core-js_shared__"]={});(e.exports=function(e,n){return t[e]||(t[e]=void 0!==n?n:{})})("versions",[]).push({version:d.version,mode:"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})}),$=c(function(e){var t=F("wks"),n=u.Symbol,r="function"==typeof n;(e.exports=function(e){return t[e]||(t[e]=r&&n[e]||(r?n:x)("Symbol."+e))}).store=t})("species"),W=function(e,t){return new(function(e){var t;return U(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!U(t.prototype)||(t=void 0),p(t)&&null===(t=t[$])&&(t=void 0)),void 0===t?Array:t}(e))(t)},G=function(e,t){var n=1==e,r=2==e,i=3==e,o=4==e,a=6==e,l=5==e||a,s=t||W;return function(t,c,u){for(var d,p,m=function(e){return Object(P(e))}(t),f=I(m),h=T(c,u,3),g=L(f.length),v=0,b=n?s(t,g):r?s(t,0):void 0;g>v;v++)if((l||v in f)&&(p=h(d=f[v],v,m),e))if(n)b[v]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return v;case 2:b.push(d)}else if(o)return!1;return a?-1:i||o?o:b}},J=function(e,t){return!!e&&f(function(){t?e.call(null,function(){},1):e.call(null)})},V=G(2);C(C.P+C.F*!J([].filter,!0),"Array",{filter:function(e){return V(this,e,arguments[1])}});d.Array.filter;var H=G(1);C(C.P+C.F*!J([].map,!0),"Array",{map:function(e){return H(this,e,arguments[1])}});d.Array.map;var z="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",q="["+z+"]",X=RegExp("^"+q+q+"*"),Y=RegExp(q+q+"*$"),Z=function(e,t,n){var r={},i=f(function(){return!!z[e]()||"​"!="​"[e]()}),o=r[e]=i?t(K):z[e];n&&(r[n]=o),C(C.P+C.F*i,"String",r)},K=Z.trim=function(e,t){return e=String(P(e)),1&t&&(e=e.replace(X,"")),2&t&&(e=e.replace(Y,"")),e};Z("trim",function(e){return function(){return e(this,3)}});d.String.trim;var Q="undefined"!=typeof window?window.navigator:void 0,ee=void 0!==e?e:void 0;t.default=function(e){return new s(e,Q,ee).detect()}}.call(this,n(14))},14:function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,c=[],u=!1,d=-1;function p(){u&&s&&(u=!1,s.length?c=s.concat(c):d=-1,c.length&&m())}function m(){if(!u){var e=l(p);u=!0;for(var t=c.length;t;){for(s=c,c=[];++d<t;)s&&s[d].run();d=-1,t=c.length}s=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||l(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},2:function(e,t,n){"use strict";var r,i=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};t.__esModule=!0,function(e){e.rerender=function(e,t){var n=e.nextSibling,r=e.parentNode;e.remove();var i=t();return n?r.insertBefore(i,n):r.appendChild(i),i},e.createElement=function(t,n){for(var r,a=[],l=2;l<arguments.length;l++)a[l-2]=arguments[l];var s=null,c="function"==typeof t;c&&t.name&&t.prototype instanceof e.ElementBase?s=new t(n).render():s=c?t(n):document.createElement(t);if(!(s instanceof HTMLElement))return console.error($(o||(o=i(["JSX Render must return a valid element: elem is not an instance of HTMLElement"],["JSX Render must return a valid element: elem is not an instance of HTMLElement"])))),console.table(((r={})['"type" argument']=t,r.Type=typeof s,r.Value=s,r)),console.trace(),null;if(a){var u=document.createDocumentFragment(),d=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r instanceof HTMLElement)u.appendChild(r);else if(Array.isArray(r))d(r);else if("number"==typeof r)u.appendChild(document.createTextNode(r.toString()));else if("string"==typeof r)u.appendChild(document.createTextNode(r));else if(null===r||void 0===r||"boolean"==typeof r)console.log("JSX got an unrenderable child value, assuming it's control flow related: type: "+typeof r+" value: "+r+".");else{var i=[];for(var o in r)i.push(r[o]);d(i)}}};d(a),s.appendChild(u)}var p=function(e){return e.startsWith("on")},m=function(e){return e.substring(2).toLowerCase()};for(var f in n){var h=n[f];if(p(f))s.addEventListener(m(f),h);else if("className"===f)if(h&&Array.isArray(h))for(var g=0,v=h;g<v.length;g++){var b=v[g];!b||b.length<=0||s.classList.add(b)}else"string"==typeof h&&h.length>0&&(s.className=s.className&&s.classList.length>0?s.className+" "+h:h);else if("style"===f)if("string"==typeof h)s.style.cssText=h;else if("object"==typeof h)for(var y in h)h&&(s.style[y]=h[y]);else void 0!==h&&console.error("Unknown style attribute type: "+typeof h+", "+h);else f.startsWith("data")?s.setAttribute(f,h):s[f]=h}return s};var t=function(){return function(){var t=this;this.elementRoot=null,this.render=function(){var e=t.internalRender();return t.setRoot(e),e},this.rerender=function(){return e.rerender(t.getRoot(),function(){return t.render()})},this.setRoot=function(e){return t.elementRoot=e},this.getRoot=function(){return t.elementRoot},this.dispose=function(){t.getRoot().remove()}}}();e.ElementBase=t}(r||(r={})),t.DOM=r;t.SidebarSeparator=function(e){var t=e&&e.big;return r.createElement("div",null,t&&r.createElement("div",{className:"clear",style:{height:t}}),r.createElement("hr",null),t&&r.createElement("div",{className:"clear",style:{height:t}}))};var o;t.SidebarCategoryTitle=function(e){return r.createElement("h3",{style:{marginBottom:"5px",marginLeft:"5px"}})}},22:function(e,t,n){"use strict";t.__esModule=!0;var r=n(5),i=n(2),o=function(){function e(){this.tabs=[],this.tabsById={},this.idTop=0,this.rescanFunc=void 0}return e.prototype.addTab=function(e){this.tabs.push(e),this.tabsById[e.id]=e},e.prototype.removeTab=function(e){delete this.tabsById[e.id];for(var t=this.tabs.length;t-- >0;){this.tabs[t].id===e.id&&this.tabs.splice(t,1)}},e}();t.InternalSheetTabData=o;var a=function(){function e(e,t){this.parent=e,this.characterId=t}return e.prototype.rerender=function(){var e=this;this.root=i.DOM.rerender(this.root,function(){return e.parent.renderFx(e)})},e.prototype.tryGetPc=function(){if(!this.contentRoot)return null;console.log(this.contentRoot);var e=null;if(this.contentRoot.hasAttribute("data-characterid"))e=this.contentRoot;else{var t=$(this.contentRoot).closest("div[data-characterid]");if(!t)return null;e=t[0]}if(!e)return null;var n=e.getAttribute("data-characterid");if(!n)return null;var i=r.R20.getCharacter(n);return i||null},e}();t.SheetTabSheetInstanceData=a;var l=function(){function e(e,t,n,r){this.byIdSheetData={},this._elements=[],this.name=e,this.renderFx=t,this.id=n,this._contentRoot=null,this.onShow=r}return e.prototype.getInstanceData=function(e){return e in this.byIdSheetData||(this.byIdSheetData[e]=new a(this,e)),this.byIdSheetData[e]},e.prototype._addElem=function(e){this._elements.push(e)},e._getInternalData=function(){return"sheetTabData"in window.r20es||(window.r20es.sheetTabData=new o),window.r20es.sheetTabData},e.add=function(t,n,r,i){var o=e._getInternalData(),a=new e(t,n,"r20es-character-sheet-tab-"+o.idTop++,r);return a.predicate=i,o.addTab(a),"function"==typeof o.rescanFunc&&o.rescanFunc(),a},e.prototype.dispose=function(){this._elements.forEach(function(e){return e.remove()}),this._elements=[],e._getInternalData().removeTab(this)},e}();t.SheetTab=l},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=(e=>{const t=e.replace(/\\/g,"/").split("/");if(t.length<=0)throw new Error("Invalid dirname given.");return t[t.length-1]+".js"})},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.R20Module=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}let a={};t.R20Module=a,a.Base=function(){function e(e){!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"getAllHooks",e=>window.r20es.hooks),this.filename=(0,r.default)(e),this.isDisposed=!0}var t=e.prototype;return t.installFirstTime=function(){},t.installUpdate=function(){},t.dispose=function(){},t.internalCanInstall=function(){return!!this.getHook().config.enabled&&(!!this.isDisposed||(console.error("Attempted to install module when it's not disposed."),console.table({"Module filename":this.filename}),console.trace(),!1))},t.internalInstallFirstTime=function(){if(this.internalCanInstall()){try{this.installFirstTime()}catch(e){console.error(e)}this.isDisposed=!1}},t.internalInstallUpdate=function(){if(this.internalCanInstall()){try{this.installUpdate()}catch(e){console.error(e)}this.isDisposed=!1}},t.internalDispose=function(){if(console.log(this),this.isDisposed)return console.error("internalDispose called on module that is already disposed!"),console.table({"Module filename":this.filename}),void console.trace();try{this.dispose()}catch(e){console.error(e)}this.isDisposed=!0},t.setConfigValue=function(e,t){const n=this.getHook(),r=this.getHook().config;if(!(e in r))return void console.error(`Tried to set config of key ${e} to value ${t} but key was not found in the config of module id ${n.id}"`);const i=r[e];r[e]=t,n.saveConfig(),r.enabled&&"onSettingChange"in this&&"function"==typeof this.onSettingChange&&this.onSettingChange(e,i,t)},t.getHook=function(){if(!1 in window.r20es)return null;for(const e in window.r20es.hooks){const t=window.r20es.hooks[e];if(t.filename&&t.filename===this.filename)return t}return null},t.toggleEnabledState=function(e){const t=this.getHook(),n=void 0===e||null===e?!t.config.enabled:e;if(t.config.enabled&&n)return;const r=t.config.enabled;t.config.enabled=n,t.saveConfig(),r&&!n?(console.log("disabling"),this.internalDispose()):!r&&n&&(console.log("enabling"),this.internalInstallUpdate())},t.install=function(){if(!("r20esInstalledModuleTable"in window))return;if(!("r20esDisposeTable"in window))return;console.log(`Installing module filename: ${this.filename}`),!(this.filename in window.r20esInstalledModuleTable)?(console.log("First run"),this.internalInstallFirstTime()):(this.filename in window.r20esDisposeTable&&console.error(`DUPLICATE MODULE FOUND: ${this.filename}`),console.log("Calling install update"),this.internalInstallUpdate()),window.r20esDisposeTable[this.filename]=(()=>{this.dispose()}),window.r20esInstalledModuleTable[this.filename]=this,console.log(`DONE! module ID: ${this.filename}`)},e}(),a.SimpleBase=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var n=t.prototype;return n.installFirstTime=function(){this.setup()},n.installUpdate=function(){this.setup()},n.setup=function(){},t}(a.Base),a.OnAppLoadBase=function(e){function t(t){var n;return(n=e.call(this,t)||this).setup=n.setup.bind(i(i(n))),n}o(t,e);var n=t.prototype;return n.installFirstTime=function(){window.r20es.isLoading?(this.earlySetup(),window.r20es.onAppLoad.addEventListener(this.setup)):(this.earlySetup(),this.setup())},n.earlySetup=function(){},n.setup=function(){},n.installUpdate=function(){this.installFirstTime()},n.dispose=function(){window.r20es.onAppLoad.removeEventListener(this.setup)},t}(a.Base),a.canInstall=(e=>window.r20es&&"canInstallModules"in window.r20es&&window.r20es.canInstallModules),a.getModule=function(e){return"r20esInstalledModuleTable"in window?window.r20esInstalledModuleTable[e]:null},a.getModuleById=function(e){return"r20esInstalledModuleTable"in window?a.getModule(window.r20es.hooks[e].filename):null}},5:function(e,t,n){"use strict";t.__esModule=!0;var r,i=n(7);!function(e){var t;function n(){return window.d20.engine.unselect()}function r(e){window.d20.engine.select(e)}function o(){return window.currentPlayer}function a(){return window.currentEditingLayer}function l(){try{var e=window.d20.Campaign.attributes.jukeboxfolder;return JSON.parse(e||"[]")}catch(e){console.error("[getJukeboxFileStructure] failed to get fs due to exception",e)}return[]}function s(e){return window.Jukebox.playlist.get(e)}function c(){return window.d20.Campaign.activePage()}function u(){return window.d20.engine.canvas.getObjects()}function d(t){for(var n=0,r=u();n<r.length;n++){var i=r[n],o=e.try_get_canvas_object_model(i);if(o&&o.get("id")===t)return i}return null}function p(e,t,n){n?($(document).on("mancerroll:"+t,function(e,r){$(document).off("mancerroll:"+t),n(e,r)}),window.d20.textchat.doChatInput(e,t)):window.d20.textchat.doChatInput(e)}function m(e){window.d20.textchat.incoming(!1,{who:"system",type:"system",content:e})}function f(){window.d20.engine.redrawScreenNextTick(!1)}!function(e){e[e.NumericAscending=0]="NumericAscending",e[e.NumericDescending=1]="NumericDescending",e[e.Alphabetical=2]="Alphabetical",e[e.AlphabeticalDescending=3]="AlphabeticalDescending",e[e.Card=4]="Card"}(t=e.InitiativeOrdering||(e.InitiativeOrdering={})),function(e){e.Map="map",e.PlayerTokens="objects",e.GMTokens="gmlayer",e.Lighting="walls",e.B20Foreground="foreground",e.B20Weather="weather"}(e.CanvasLayer||(e.CanvasLayer={})),e.setBackgroundStyle=function(e){window.d20.engine.backgroundColor=e},e.setupImageDropTarget=function(e,t,n){var r={model:{save:t},updateModel:n};window.d20.utils.setupAvatar(e,r)},e.getCanvasMousePos=function(){return window.d20.engine.mousePos.slice()},e.onInitiativeChange=function(t){return new i.EventSubscriber("change:turnorder",t,function(){return e.getInitiativeWindow().model})},e.setCanvasObjectLocation=function(t,n,r){var i=e.try_get_canvas_object_model(t);i&&i.save({top:r,left:n})},e.getBlob=function(e,t,n){return void 0===n&&(n=5e3),new Promise(function(r,i){e._getLatestBlob(t,r),setTimeout(i,n)})},e.getCampaign=function(){return window.Campaign},e.canEditCharacter=function(t){var n=t.attributes.controlledby;return!!e.isGM()||(!!n.includes("all")||!!n.includes(e.getCurrentPlayer().id))},e.getHandout=function(e){return window.Campaign.handouts.get(e)},e.createCharacter=function(e){return window.Campaign.characters.create(e)},e.setCanvasObjectDimensions=function(t,n,r){var i=e.try_get_canvas_object_model(t);i&&i.save({width:n,height:r})},e.getCharacter=function(e){return window.Campaign.characters.get(e)},e.getAllCharacters=function(){return window.Campaign.characters.models},e.getAllPages=function(){return window.Campaign.pages.models},e.createRollableTable=function(e){return window.d20.Campaign.rollabletables.create(e)},e.getRollableTable=function(e){return window.d20.Campaign.rollabletables.get(e)},e.getSelectedTokens=function(){return window.d20.engine.selected()},e.unselectTokens=n,e.addTokenToSelection=r,e.selectToken=function(e){n(),r(e)},e.hideTokenRadialMenu=function(){window.d20.token_editor.removeRadialMenu()},e.hideTokenContextMenu=function(){window.d20.token_editor.closeContextMenu()},e.getCurrentPlayer=o,e.getCanvasZoom=function(){return window.d20.engine.canvasZoom},e.getCanvasWidth=function(){return window.d20.engine.canvas.width},e.getCanvasHeight=function(){return window.d20.engine.canvas.height},e.getCanvasOffsetX=function(){return window.d20.engine.currentCanvasOffset[0]},e.getCanvasOffsetY=function(){return window.d20.engine.currentCanvasOffset[1]},e.getPageById=function(e){return window.Campaign.pages.get(e)},e.isGM=function(){return window.is_gm},e.getCurrentLayer=a,e.generateUUID=function(){return window.generateUUID()},e.getCurrentToolName=function(){return window.d20.engine.mode},e.advanceInitiative=function(){window.d20.Campaign.initiativewindow.nextTurn()},e.addTokenToInitiative=function(e){window.d20.Campaign.initiativewindow.addTokenToList(e)},e.addCustomItemToInitiative=function(e,t){window.d20.Campaign.initiativewindow.addTokenToList("-1",e,t)},e.rerenderMacroBar=function(){window.d20.player_settings.refreshMacroBar()},e.rerenderJournalMacros=function(){window.d20.player_settings.refreshRollsList()},e.orderInitiativeBy=function(e){var n,r=((n={})[t.NumericAscending]=".sortlist_numeric",n[t.NumericDescending]=".sortlist_numericdesc",n[t.Alphabetical]=".sortlist_alpha",n[t.AlphabeticalDescending]=".sortlist_alphadesc",n[t.Card]=".sortlist_card",n);if(e in r){var i=r[e];$("#initiativewindow_settings").dialog({modal:!1,title:"Turn Order Settings",beforeClose:function(){}}),$(i).click()}else console.error("Invalid initiative ordering: "+e)},e.getInitiativeWindow=function(){return window.d20.Campaign.initiativewindow},e.getJukeboxFileStructure=l,e.setJukeboxFileStructure=function(t){e.getCampaign().save({jukeboxfolder:JSON.stringify(t)})},e.createPlaylist=function(e){return window.d20.jukebox.addFolderToFolderStructure(e)},e.addTrackToPlaylist=function(e,t){return window.d20.jukebox.addItemToFolderStructure(e,t)},e.getSongById=s,e.getJukeboxPlaylists=function(){for(var e=[],t=0,n=l();t<n.length;t++){var r=n[t];if("string"!=typeof r){for(var i=r,o={id:i.id,name:i.n,mode:i.s,songs:[]},a=0,c=i.i;a<c.length;a++){var u=c[a],d=s(u);d?o.songs.push(d):console.warn("Tried to get song id "+u+" but the query returned a falsy value. Skipping")}e.push(o)}}return e},e.playAudio=function(e,t){window.Jukebox.soundObjs[e]=window.soundManager.createSound({id:e,url:t})},e.createSong=function(e){return window.Jukebox.playlist.create(e)},e.makePlaylistStructure=function(e,t,n){return{id:window.generateUUID(),n:e,s:t,i:n||[]}},e.getInitiativeData=function(){return window.d20.Campaign.initiativewindow.cleanList()},e.setInitiativeData=function(e){window.d20.Campaign.initiativewindow.model.save({turnorder:JSON.stringify(e)})},e.getCurrentPage=c,e.getCurrentPageTokens=u,e.doesTokenContainMouse=function(e,t){return window.d20.engine.canvas.containsPoint(e,t)},e.getCurrentPageTokenByUUID=d,e.try_get_canvas_object_model=function(e){return e._model?e._model:e.model?e.model:null},e.isUsing5EOGLSheet=function(){try{return window.d20.journal.customSheets.workerScripts[0].includes("5th Edition OGL by Roll20")}catch(e){return!1}},e.moveCameraToTokenByUUID=function(e){if(e){var t=d(e);if(t){var n=$("#editor-wrapper")[0];n.scrollTop=Math.floor(t.top*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasHeight/2)+125*window.d20.engine.canvasZoom,n.scrollLeft=Math.floor(t.left*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasWidth/2)+125*window.d20.engine.canvasZoom}}},e.primitiveSay=function(e,t){window.d20.textchat.doChatInput(e,t)},e.say=p,e.sayToSelf=function(t,n){var r='/w "'+o().get("displayname")+'" '+t;n?p(r,e.generateUUID(),n):p(r)},e.saySystemRaw=m,e.saySystem=function(e){m('<span style="background: rgba(6,26,45,255);\n    color: whitesmoke;\n    border: none;\n    display: inline-block;\n    padding: 8px;\n    margin: -15px -5px -7px -45px;    \n    "\n>\n'+e+"\n</span>\n        ")},e.ping=function(e,t,n,r,i){n=n||o().id,window.d20.engine.pings[n]={left:e,top:t,radius:-5,player:n,pageid:r||c().id,currentLayer:i||a()},window.d20.engine.pinging={downx:e,downy:t},f()},e.getFabric=function(){return window.exports.fabric},e.renderAll=f,e.setGMLayerOpacity=function(e){window.d20.engine.gm_layer_opacity=e},e.hasBetteR20=function(){return void 0!==window.d20plus},e.wipeObjectStorage=function(e){for(var t=e.length,n=0;n<t;n++){var r=e.length-1;if(0>r)break;var i=e.models[r];if(!i||void 0===i)break;i.destroy()}e.length<0&&console.error("FAILED TO WIPE OBJECT STORAGE!")},e.doBulkRoll=function(t,n,r,i,o){e.unselectTokens();var a=function(t){if(e.selectToken(t),o){var r=o(t);r&&e.say(n,r.id,r.callback)}else e.say(n)},l=function(){if(e.hideTokenRadialMenu(),e.hideTokenContextMenu(),i)for(var n=0,r=t;n<r.length;n++){var o=r[n];e.addTokenToSelection(o)}};if(0===r){for(var s=0,c=t;s<c.length;s++){var u=c[s];a(u)}l()}else for(var d=r,p=function(e){setTimeout(function(){a(t[e]),e+1===t.length&&l()},d),d+=r},m=0;m<t.length;m++)p(m)}}(r||(r={})),t.R20=r},6:function(e,t,n){"use strict";t.__esModule=!0;var r=n(8);t.copy=function(e,t){var n=Object.assign({},e);return t&&(n=Object.assign(n,t)),n};var i=function(e){if("currentTransform"in e)return e.currentTransform;if("getTransform"in e)return e.getTransform();if(e.mozCurrentTransform){var t=e.mozCurrentTransform;return{a:t[0],b:t[1],c:t[2],d:t[3],e:t[4],f:t[5]}}};t.getTransform=i;t.getRotation=function(e){var t=i(e),n=Math.atan2(t.b,t.a);return n<0&&(n+=2*Math.PI),n};t.findByIdAndRemove=function(e){var t=document.getElementById(e);t&&t.remove()};t.mapObj=function(e,t){return Object.keys(e).reduce(function(n,r){var i=t(e[r],r);return void 0!==i&&null!==i&&n.push(i),n},[])};t.safeCall=function(e){try{e()}catch(e){console.error(e)}};t.removeAllChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)};t.replaceAll=function(e,t,n){return e.replace(new RegExp(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(t),"g"),n)};t.safeParseJson=function(e){try{return JSON.parse(e)}catch(e){alert("File is not a valid JSON file.")}return null};t.readFile=function(e){return new Promise(function(t,n){if(e){var r=new FileReader;r.readAsText(e),r.onload=function(e){t(e.target.result)}}else n("No file given.")})};var o=function(){return chrome||browser};t.getBrowser=o;t.injectScript=function(e){console.log("Injecting "+e);var t=document.createElement("script");t.async=!1,t.src=o().extension.getURL(e),t.onload=function(){t.remove()},document.head.appendChild(t)};t.strIsNullOrEmpty=function(e){return null===e||void 0===e||e.length<=0||e.trim().length<=0};t.createCSSElement=function(e,t){var n=document.createElement("style");return n.innerHTML=e,n.id=t,n};t.getExtUrlFromPage=function(e,t){var n=void 0===t||null===t?1e3:t;return new Promise(function(t,i){try{var o=!1,a=function(){window.removeEventListener("message",s)},l=window.generateUUID(),s=function(e){e.origin===r.Config.appUrl&&e.data.r20esGivesResourceUrl&&e.data.r20esGivesResourceUrl.id===l&&(o=!0,a(),t(e.data.r20esGivesResourceUrl.url))};window.addEventListener("message",s);var c={resource:e,id:l};window.postMessage({r20esWantsResourceUrl:c},r.Config.appUrl),setTimeout(function(){try{o||(a(),i("Timed out after "+n+"ms"))}catch(e){i(e)}},n)}catch(e){i(e)}})}},7:function(e,t,n){"use strict";t.__esModule=!0;var r=function(){function e(e,t,n){this._isSubscribed=!1,this._name=e,this._callback=t,this._targetGetter=n}return e.subscribe=function(t,n,r){var i=new e(t,n,r);return i.subscribe(),i},e.prototype.subscribe=function(){if(!this._isSubscribed){var e=this._targetGetter();"on"in e?e.on(this._name,this._callback):e.addEventListener(this._name,this._callback),this._isSubscribed=!0}},e.prototype.unsubscribe=function(){if(this._isSubscribed){var e=this._targetGetter();"off"in e?e.off(this._name,this._callback):e.removeEventListener(this._name,this._callback),this._isSubscribed=!1}},e}();t.EventSubscriber=r},73:function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t,n){var r=n(e),i=n(t);return r<i?-1:r>i?1:0}},8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;let r={};t.Config=r,r.appUrl="https://app.roll20.net",r.websiteFeatureUrlTemplate="https://ssstormy.github.io/roll20-enhancement-suite/features#",r.website="https://ssstormy.github.io/roll20-enhancement-suite/",r.discordInvite="https://discord.gg/pKxxvuM",r.contributeUrl="https://ssstormy.github.io/roll20-enhancement-suite/contribute.html"}});