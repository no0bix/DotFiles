(function(){"use strict";var e=this,t,r,i;!function(e){var o,n,s,a,u={},c={},l={},d={},p=Object.prototype.hasOwnProperty,f=[].slice,m=/\.js$/;function v(e,t){return p.call(e,t)}function g(e,t){var r,i,o,n,s,a,u,c,d,p,f,v,g=t&&t.split("/"),y=l.map,h=y&&y["*"]||{};if(e){for(s=(e=e.split("/")).length-1,l.nodeIdCompat&&m.test(e[s])&&(e[s]=e[s].replace(m,"")),"."===e[0].charAt(0)&&g&&(e=(v=g.slice(0,g.length-1)).concat(e)),d=0;d<e.length;d++)if("."===(f=e[d]))e.splice(d,1),d-=1;else if(".."===f){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((g||h)&&y){for(d=(r=e.split("/")).length;d>0;d-=1){if(i=r.slice(0,d).join("/"),g)for(p=g.length;p>0;p-=1)if((o=y[g.slice(0,p).join("/")])&&(o=o[i])){n=o,a=d;break}if(n)break;!u&&h&&h[i]&&(u=h[i],c=d)}!n&&u&&(n=u,a=c),n&&(r.splice(0,a,n),e=r.join("/"))}return e}function y(t,r){return function(){var i=f.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),n.apply(e,i.concat([t,r]))}}function h(e){return function(t){return g(t,e)}}function b(e){return function(t){u[e]=t}}function S(t){if(v(c,t)){var r=c[t];delete c[t],d[t]=!0,o.apply(e,r)}if(!v(u,t)&&!v(d,t))throw new Error("No "+t);return u[t]}function w(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function P(e){return e?w(e):[]}function _(e){return function(){return l&&l.config&&l.config[e]||{}}}s=function(e,t){var r,i=w(e),o=i[0],n=t[1];return e=i[1],o&&(r=S(o=g(o,n))),o?e=r&&r.normalize?r.normalize(e,h(n)):g(e,n):(o=(i=w(e=g(e,n)))[0],e=i[1],o&&(r=S(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:r}},a={require:function(e){return y(e)},exports:function(e){var t=u[e];return void 0!==t?t:u[e]={}},module:function(e){return{id:e,uri:"",exports:u[e],config:_(e)}}},o=function(t,r,i,o){var n,l,p,f,m,g,h=[],w=typeof i,_;if(g=P(o=o||t),"undefined"===w||"function"===w){for(r=!r.length&&i.length?["require","exports","module"]:r,m=0;m<r.length;m+=1)if("require"===(l=(f=s(r[m],g)).f))h[m]=a.require(t);else if("exports"===l)h[m]=a.exports(t),_=!0;else if("module"===l)n=h[m]=a.module(t);else if(v(u,l)||v(c,l)||v(d,l))h[m]=S(l);else{if(!f.p)throw new Error(t+" missing "+l);f.p.load(f.n,y(o,!0),b(l),{}),h[m]=u[l]}p=i?i.apply(u[t],h):void 0,t&&(n&&n.exports!==e&&n.exports!==u[t]?u[t]=n.exports:p===e&&_||(u[t]=p))}else t&&(u[t]=i)},t=r=n=function(t,r,i,u,c){if("string"==typeof t)return a[t]?a[t](r):S(s(t,P(r)).f);if(!t.splice){if((l=t).deps&&n(l.deps,l.callback),!r)return;r.splice?(t=r,r=i,i=null):t=e}return r=r||function(){},"function"==typeof i&&(i=u,u=c),u?o(e,t,r,i):setTimeout(function(){o(e,t,r,i)},4),n},n.config=function(e){return n(e)},t._defined=u,(i=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),v(u,e)||v(c,e)||(c[e]=[e,t,r])}).amd={jQuery:!0}}();var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(o,n){function s(e){try{u(i.next(e))}catch(e){n(e)}}function a(e){try{u(i.throw(e))}catch(e){n(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,a)}u((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i,o,n,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=2&s[0]?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(n=(n=r.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(6===s[0]&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},a=this&&this.__decorate||function(e,t,r,i){var o=arguments.length,n=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(o<3?s(n):o>3?s(t,r,n):s(t,r))||n);return o>3&&n&&Object.defineProperty(t,r,n),n},u=this&&this.__extends||(c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),c;i("common/services/form-detection/form-profile",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/services/form-detection/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/enums/auto-fill-action",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.AutoFillAction||(t.AutoFillAction={})).Login="Login",i.Email="Email",i.Address="Address",i.PersonalName="PersonalName"}),i("common/enums/auto-fill-input-category",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.AutoFillInputCategory||(t.AutoFillInputCategory={})).Name="name",i.FullName="fullName",i.FirstName="firstName",i.LastName="lastName",i.Address="address",i.Email="email",i.Password="password",i.UserName="userName"}),i("common/enums/auto-fill-method",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.AutoFillAlgorithm||(t.AutoFillAlgorithm={})).Legacy="Legacy",i.Euclidean="Euclidean"}),i("common/enums/feature-type",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.FeatureType||(t.FeatureType={})).AngularFrontendEnabled="angularFrontendEnabled",i.AutoFillControl="autofill_control",i.AutoFillTest="autofill_test",i.BetterGeneratePasswordEnabled="better_generate_password_enabled",i.Block30="block_3_0",i.EmergencyAccessRestricted="emergency_access_restricted",i.FamiliesEnabled="families_enabled",i.FamilyLegacySharedFoldersEnabled="family_legacy_shared_folders_enabled",i.FamilySharedFoldersEnabled="family_shared_folders_enabled",i.FormfillMigration="formfill_migration",i.Freamon="freamon",i.HealthMonitoring="health_monitoring",i.ICOB="icob",i.IntroTutorialVersion="intro_tutorial_version",i.IsDogfood="isDogfood",i.IsInfieldEnabled="is_infield_enabled",i.IsMobileActive="is_mobile_active",i.NewSaveSite="new_save_site",i.OmarDrawer="omardrawer",i.OmarIa="omaria",i.OmarInfieldB="omar_infield_b",i.OmarInfieldC="omar_infield_c",i.OneToOneSharingRestricted="one_to_one_sharing_restricted",i.PasswordSubmittedEvent="password_submitted_event",i.Pdkdf2IterationsMigration="pbkdf2_iterations_migration",i.Retire30="retire_3_0",i.TryFamiliesEnabled="try_families_enabled",i.WebRequestEnabled="save_a_site_web_request",i.Ziggy="ziggy"}),i("common/enums/repository-type",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.RepositoryType||(t.RepositoryType={})).Feature="Feature",i.AutoFillState="AutoFillState"}),i("common/enums/resolver-type",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.ResolverType||(t.ResolverType={})).PasswordSubmitted="Password Submitted",i.InjectedPasswordSubmitted="Injected Password Submitted"}),i("common/enums/save-site-action",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.SaveSiteAction||(t.SaveSiteAction={})).Add="Add",i.OK="OK",i.Update="Update",i.NotNow="Not Now",i.Undo="Undo",i.Never="Never"}),i("common/enums/save-site-event-type",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.SaveSiteDialogEventType||(t.SaveSiteDialogEventType={})).SaveSiteDialogAction="Save a Site Action Clicked",i.SaveSiteDialogDuplicateDeleteClicked="Save a Site Duplicate Delete Clicked",i.SaveSiteDialogDuplicateKeepClicked="Save a Site Duplicate Keep Clicked",i.SaveSiteDialogEditClicked="Save a Site Edit Clicked",i.SaveSiteDialogNewClicked="Save a Site New Clicked",i.SaveSiteDialogSelectClicked="Save a Site Select Clicked",i.SaveSiteDialogViewed="Save a Site Viewed",i.SaveSiteDialogAnotherClicked="Save a Site Another Clicked"}),i("common/enums/segment-event-type",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.SegmentEventType||(t.SegmentEventType={})).SaveSiteDialog="savesitedialog"}),i("common/enums/service-type",["require","exports"],function(e,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=r=t.ServiceType||(t.ServiceType={})).BasicAuth="BasicAuth",i.ContentScriptTools="ContentScriptTools",i.DomUtils="DomUtils",i.FormDetection="FormDetection",i.AutoFill="AutoFill",i.FormParser="FormParser",i.Segment="Segment",i.Site="Site",i.StringUtils="StringUtils",i.Topic="Topic",i.WebRequest="WebRequest",i.WebRequestShim="WebRequestShim"}),i("common/enums/topic-type",["require","exports","common/legacy"],function(e,t,r){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=i=t.TopicType||(t.TopicType={}))[o.ClearData=r.LegacyGlobalCommon.Topics.CLEAR_DATA]="ClearData",o[o.FilledGeneratedPassword=r.LegacyGlobalCommon.Topics.FILLED_GENERATED_PW]="FilledGeneratedPassword",o[o.Initialized=r.LegacyGlobalCommon.Topics.INITIALIZED]="Initialized",o[o.Login=r.LegacyGlobalCommon.Topics.LOGIN]="Login",o[o.LoginFinished=r.LegacyGlobalCommon.Topics.LOGIN_FINISHED]="LoginFinished",o[o.ProcessedFormSubmit=r.LegacyGlobalCommon.Topics.PROCESSED_FORM_SUBMIT]="ProcessedFormSubmit",o[o.RequestFrameworkInitialized=r.LegacyGlobalCommon.Topics.REQUEST_FRAMEWORK_INITIALIZED]="RequestFrameworkInitialized",o[o.PasswordFormSubmitted=r.LegacyGlobalCommon.Topics.PASSWORD_FORM_SUBMITTED]="PasswordFormSubmitted"}),i("common/enums/index",["require","exports","common/enums/auto-fill-action","common/enums/auto-fill-input-category","common/enums/auto-fill-method","common/enums/feature-type","common/enums/repository-type","common/enums/resolver-type","common/enums/save-site-action","common/enums/save-site-event-type","common/enums/segment-event-type","common/enums/service-type","common/enums/topic-type"],function(e,t,r,i,o,n,s,a,u,c,l,d,p){function f(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),f(r),f(i),f(o),f(n),f(s),f(a),f(u),f(c),f(l),f(d),f(p)}),i("common/repositories/auto-fill-state/auto-fill-algorithm-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/repositories/auto-fill-state/auto-fill-frame-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/repositories/auto-fill-state/auto-fill-state",["require","exports","common/enums/index"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.tabId=e,this.url=t,this.frames={}}return Object.defineProperty(e.prototype,"isReady",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){var r=e.frames[t];return r.isReady||!r.isAllowed})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAllowed",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){return e.frames[t].isAllowed})},enumerable:!0,configurable:!0}),e.prototype.tryGetFrame=function(e){return this.frames[e]||(this.frames[e]=this.getEmptyFrame()),this.frames[e]},e.prototype.getEmptyFrame=function(){return{elements:{},isAllowed:!0,isReady:!1}},e.prototype.setFrameAllowed=function(e,t){var r;this.tryGetFrame(e).isAllowed=t},e.prototype.setFrameReady=function(e,t){var r;this.tryGetFrame(e).isReady=t},e.prototype.getFrameAlgorithmState=function(e,t,r){var i=this.tryGetFrame(e);if(i.elements[t])return i.elements[t][r]},e.prototype.setFrameAlgorithmState=function(e,t,r,i){var n=this.tryGetFrame(e),s=n.elements[t];s||(s={},n.elements[t]=s),n.elements[t][r]=o({},s[r],i)},e.prototype.resetFrameState=function(e){this.frames[e]&&(this.frames[e]=this.getEmptyFrame())},e.prototype.deleteFrameState=function(e){this.frames[e]&&delete this.frames[e]},e.prototype.getResults=function(){var e=this,t={count:0};Object.keys(r.AutoFillAlgorithm).forEach(function(e){t[e]=0});var i={allowed:this.isAllowed,userName:o({},t),password:o({},t)};return Object.keys(this.frames).forEach(function(n){var s=e.frames[n];s.isAllowed&&s.isReady&&Object.keys(s.elements).forEach(function(e){return Object.keys(s.elements[e]).forEach(function(n){var a,u=s.elements[e][n].filledWith;if(u&&"none"!==u){i[u]||(i[u]=o({},t));var c=i[u][n]+1;n===r.AutoFillAlgorithm.Legacy&&(i[u].count=c),i[u][n]=c}})})}),i},e}();t.AutoFillState=i}),i("common/repositories/auto-fill-state/index",["require","exports","common/repositories/auto-fill-state/auto-fill-state"],function(e,t,r){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r)}),i("common/interfaces/auto-fill-state.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/auto-fill.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/feature.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/segment.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/segment-event",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/serializable-callback",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/serializable-value",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/web-request-shim.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/web-request.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("background/interfaces/content-script-target",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("background/services/form-parser/form-meta-data",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.passwordsByValue={},this.textFieldsByValue={},this.textFieldsByType={},this.uniqueTextValues=[],this.uniquePasswords=[],e.fields&&(e.fields.forEach(function(e){"password"===e.type?t.aggregateField(e,e.value,t.passwordsByValue):(t.aggregateField(e,e.value,t.textFieldsByValue),t.aggregateField(e,e.type,t.textFieldsByType))}),this.uniqueTextValues=Object.keys(this.textFieldsByValue),this.uniquePasswords=Object.keys(this.passwordsByValue))}return e.prototype.aggregateField=function(e,t,r){var i=r[t];i?++i.count:r[t]={field:e,count:1}},e}();t.FormMetaData=r}),i("background/interfaces/parsed-form",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("background/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("background/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/legacy",["require","exports"],function(t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LegacyGlobalCommon=e}),i("common/module.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this._isInitialized=!1,this.initializedQueue=[],setTimeout(function(){return n(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.initialize()];case 1:return e.sent(),[4,this.postInitialize()];case 2:for(e.sent(),this._isInitialized=!0;this.initializedQueue.length;)try{this.initializedQueue.pop()()}catch(e){console.error(e)}return[2]}})})})}return e.prototype.isInitialized=function(e){this._isInitialized?e():this.initializedQueue.push(e)},e}();t.ModuleAbstract=r}),i("common/provider.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=!0);var r=this;this.instances={},this.initialized=!1,e&&e.size&&(this.map=e,this.map.forEach(function(e,i){e.delegated&&!t||(r.instances[i]=new e.ctor)}))}return e.prototype.initialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){return e.instances[t].initialize()}),this.initialized=!0},e.prototype.postInitialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){"function"==typeof e.instances[t].postInitialize&&e.instances[t].postInitialize()})},e.prototype.teardown=function(){var e=this;Object.keys(this.instances).forEach(function(t){e.instances[t]&&"function"==typeof e.instances[t].destroy&&e.instances[t].destroy()})},e}();t.ProviderAbstract=r}),i("common/decorators/register-repository.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;function i(e,t){return void 0===t&&(t=!1),function(i){r.set(e,{ctor:i,delegated:t})}}function o(){return r}t.RegisterRepository=i,t.getRepositoryRegistry=o}),i("common/decorators/register-service.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;function i(e,t){return void 0===t&&(t=!1),function(i){r.set(e,{ctor:i,delegated:t})}}function o(){return r}t.RegisterService=i,t.getServiceRegistry=o}),i("common/messaging/messaging",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new WeakMap;function i(e,t){var i=e.constructor,o=r.get(i);o&&o.size?o.add(t):o=new Set([t]),r.set(i,o)}t.addVisibleMethod=i;var o=null;function a(){return o}function u(e,t,i,a,u){return void 0===i&&(i=[]),n(this,void 0,void 0,function(){var n,l,d;return s(this,function(s){switch(s.label){case 0:if(s.trys.push([0,3,4,5]),!e||!e.constructor)throw new Error("No target provided!");if(!r.has(e.constructor))throw new Error("Target has no visible methods.");if(!r.get(e.constructor).has(t))throw new Error("Method [ "+t+" ] is not a visible method.");if("function"!=typeof(n=e[t]))throw new Error("Method [ "+t+" ] is not a function or does not exist on the target.");return o=Object.freeze({calleeTab:Object.freeze(u)}),(l=n.bind(e).apply(void 0,i))&&"function"==typeof l.then?[4,l]:[3,2];case 1:l=s.sent(),s.label=2;case 2:return a(null,l),[3,5];case 3:return c(d=s.sent(),a),[3,5];case 4:return o=null,[7];case 5:return[2]}})})}function c(e,t){if("function"==typeof t){var r=void 0;"string"==typeof e?r=e:e instanceof Error&&(r="string"==typeof e.message?e.message:"function"==typeof e.toString?e.toString():"Unknown error"),t(r)}else console.error(e)}t.getInvokatingMessageContext=a,t.callMethod=u,t.handleCallbackError=c}),i("common/decorators/visible.decorator",["require","exports","common/messaging/messaging"],function(e,t,r){function i(e,t,i){r.addVisibleMethod(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Visible=i}),i("common/decorators/index",["require","exports","common/decorators/register-repository.decorator","common/decorators/register-service.decorator","common/decorators/visible.decorator"],function(e,t,r,i,o){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(i),n(o)}),i("common/interfaces/site.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),i("common/services/topic/topic.service",["require","exports","common/decorators/index","common/enums/index","common/legacy"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.subscribe=function(e,t){o.LegacyGlobalCommon.Topics.get(e).subscribe(function(e){return t(e)})},e=a([r.RegisterService(i.ServiceType.Topic)],e)}();t.TopicService=n}),i("common/services/utils/string-utils.service",["require","exports","common/decorators/index","common/enums/index"],function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.stringContains=function(e,t){if(e&&t){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;++r)if(e.indexOf(t[r])>-1)return!0}return!1},e.prototype.containsMaskingCharacter=function(e){return e.indexOf("*")>-1||e.indexOf(String.fromCharCode(8226))>-1},e=a([r.RegisterService(i.ServiceType.StringUtils)],e)}();t.StringUtilsService=o}),i("background/legacy",["require","exports"],function(t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LegacyGlobal=e}),i("background/repositories/auto-fill-state/auto-fill-state.repository",["require","exports","common/decorators/index","common/enums/index","common/repositories/auto-fill-state/index","background/legacy"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.states=new Map}return e.prototype.tryGetState=function(e){var t;try{t=this.getState(e)}catch(e){if(!(e instanceof ReferenceError))throw e}if(!t){var r=n.LegacyGlobal.LPTabs.get({tabID:e}),i=void 0;r&&(i=r.tabDetails.tabURL),t=new o.AutoFillState(e,i),this.setState(t)}return t},e.prototype.initialize=function(){},e.prototype.getState=function(e,t){var r=this.states.get(e);if(!r){var i="Could not find state for tab: "+e;if("function"==typeof t)return void t(i);throw new ReferenceError(i)}if("function"!=typeof t)return r;t(null,r)},e.prototype.setState=function(e){this.states.set(e.tabId,e)},e.prototype.deleteState=function(e){this.states.delete(e)},e.prototype.resetFrameState=function(e,t){this.states.has(e)&&this.states.get(e).resetFrameState(t)},e.prototype.deleteFrameState=function(e,t){this.states.has(e)&&this.states.get(e).deleteFrameState(t)},e.prototype.getFrameAlgorithmState=function(e,t,r,i,o){var n;try{var s=this.getState(e);n=s.getFrameAlgorithmState(t,r,i)}catch(e){if(!(e instanceof ReferenceError))throw e;n={}}if("function"!=typeof o)return n;o(null,n)},e.prototype.setFrameAlgorithmState=function(e,t,r,i,o){var n;this.tryGetState(e).setFrameAlgorithmState(t,r,i,o)},e.prototype.setFrameAllowed=function(e,t,r){var i;this.tryGetState(e).setFrameAllowed(t,r)},e.prototype.setFrameReady=function(e,t,r){var i;this.tryGetState(e).setFrameReady(t,r)},e.prototype.getFillResults=function(e,t,r){var i;t=t||0;try{var o=this.getState(e);i=o.getResults()}catch(e){i={}}if("function"!=typeof r)return i;r(null,i)},a([r.Visible],e.prototype,"getState",null),a([r.Visible],e.prototype,"setState",null),a([r.Visible],e.prototype,"deleteState",null),a([r.Visible],e.prototype,"resetFrameState",null),a([r.Visible],e.prototype,"deleteFrameState",null),a([r.Visible],e.prototype,"getFrameAlgorithmState",null),a([r.Visible],e.prototype,"setFrameAlgorithmState",null),a([r.Visible],e.prototype,"setFrameAllowed",null),a([r.Visible],e.prototype,"setFrameReady",null),a([r.Visible],e.prototype,"getFillResults",null),e=a([r.RegisterRepository(i.RepositoryType.AutoFillState)],e)}();t.AutoFillStateRepository=s}),i("background/repositories/feature/feature.repository",["require","exports","common/decorators/index","common/enums/index","background/legacy"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){var e=this;this.featureEnumNames=new Set,this.featurePropertyNames=new Set,Object.keys(i.FeatureType).forEach(function(t){e.featureEnumNames.add(t),e.featurePropertyNames.add(i.FeatureType[t])})}return e.prototype.initialize=function(){},e.prototype.get=function(e){return o.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]},e.prototype.set=function(e,t){o.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]=t},e.prototype.resolvePropertyName=function(e){if(this.featureEnumNames.has(e))return i.FeatureType[e];if(this.featurePropertyNames.has(e))return e;throw new TypeError("Unrecognized feature name: [ "+e+" ]")},a([r.Visible],e.prototype,"get",null),a([r.Visible],e.prototype,"set",null),e=a([r.RegisterRepository(i.RepositoryType.Feature)],e)}();t.FeatureRepository=n}),i("background/repositories/repository-provider",["require","exports","common/provider.abstract","common/messaging/messaging"],function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.getRepository=function(e){return this.instances[e]},t.prototype.call=function(e,t,r,o,n){void 0===r&&(r=[]);try{i.callMethod(this.getRepository(e),t,r,o,n)}catch(e){i.handleCallbackError(e,o)}},t}(r.ProviderAbstract);t.RepositoryProvider=o}),i("background/repositories/index",["require","exports","background/repositories/auto-fill-state/auto-fill-state.repository","background/repositories/feature/feature.repository","background/repositories/repository-provider"],function(e,t,r,i,o){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(i),n(o)}),i("background/services/service-provider",["require","exports","common/provider.abstract","common/enums/index","common/messaging/messaging","background/background.module"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.getService=function(e,t){var r=this.map.get(e);if(!r)return null;var i=r.delegated,o;if(!t&&i)throw new Error("Must provide a target for delegated service [ "+e+" ]");if(t&&!i)throw new Error("Target not supported for non-delegated service [ "+e+" ]");return i?new r.ctor(t):this.instances[e]},t.prototype.postInitialize=function(){e.prototype.postInitialize.call(this),window.basicAuth=this.getService(i.ServiceType.BasicAuth)},t.prototype.call=function(e,t,r,i,n){void 0===r&&(r=[]);try{o.callMethod(this.getService(e),t,r,i,n)}catch(e){o.handleCallbackError(e,i)}},t}(r.ProviderAbstract);function a(e,t,r,i,s){n.getContentScriptInterfaces(e).then(function(e){return e.forEach(function(e){if("function"!=typeof s)return new Promise(function(o,n){e.LPModule.callService(t,r,i,function(e,t){return e?n(e):o(t)})});e.LPModule.callService(t,r,i,s)})}).catch(function(e){o.handleCallbackError(e,s)})}t.ServiceProvider=s,t.callContentScriptService=a}),i("background/services/auto-fill/delegated-auto-fill.service",["require","exports","common/decorators/index","common/enums/index","background/services/service-provider"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this.target=e}return e.prototype.initialize=function(){},e.prototype.fill=function(e){return n(this,void 0,void 0,function(){return s(this,function(t){return o.callContentScriptService(this.target,i.ServiceType.AutoFill,"fill",[e]),[2]})})},e=a([r.RegisterService(i.ServiceType.AutoFill,!0)],e)}();t.DelegatedAutoFillService=u}),i("background/services/basic-auth/auth-credential",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,i){void 0===t&&(t=""),void 0===r&&(r=""),void 0===i&&(i=!1),this.url=e,this.userName=t,this.password=r,this.suppliedBefore=i,this.cancelled=!1}return e}();t.AuthCredential=r}),i("background/services/basic-auth/basic-auth.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/services/basic-auth/auth-credential"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.authCredentials={}}return e.prototype.initialize=function(){this.subscribeEvents()},e.prototype.subscribeEvents=function(){var e=this;o.LegacyGlobal.LPPlatform.onAuthRequired(function(t,r){if(o.LegacyGlobal.g_basicauth_feature_enabled&&"basic"===t.scheme){var i=e.authCredentials[t.tabId];if(i&&!i.cancelled&&!i.suppliedBefore)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url,i.userName,i.password,!0),e.removeAuth(r),{authCredentials:{username:i.userName,password:i.password}};if(!i)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url),{cancel:!0}}}),o.LegacyGlobal.LPPlatform.onTabClosed(function(t){e.removeAuth(t)})},e.prototype.removeAuth=function(e){var t;this.authCredentials[e]&&delete this.authCredentials[e]},e.prototype.isBasicAuth=function(e,t){var r=!1,i=!1;if(t&&t.tabID){var o=this.authCredentials[t.tabID];o&&(o.url!==t.tabURL?this.removeAuth(t.tabID):o.cancelled||(r=!0,i=o.suppliedBefore))}e(r,i)},e.prototype.setAuthCredential=function(e,t,r,i){var o=this.authCredentials[i.tabID];o.userName=e,o.password=t,r()},e.prototype.cancelBasicAuth=function(e){var t;this.authCredentials[e.tabID]&&(this.authCredentials[e.tabID].cancelled=!0)},e.prototype.hasFeature=function(e){e(!0)},e.prototype.isNotificationClosed=function(e){e("closed"===o.LegacyGlobal.localStorage_getItem("basicAuthPopupState"))},e.prototype.closeNotification=function(){o.LegacyGlobal.localStorage_setItem("basicAuthPopupState","closed")},e=a([r.RegisterService(i.ServiceType.BasicAuth)],e)}();t.BasicAuthService=s}),i("background/services/form-parser/field-parsers/field-parser.abstract",["require","exports","background/legacy"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.operations=[]}return e.regexMatches=function(e,t){var r=!1;if(e){var i=function(e,t){return"string"==typeof t&&e.test(t.toLowerCase())};Array.isArray(t)?t.forEach(function(t){return r=r||i(e,t)}):r=i(e,t)}return r},e.getFormFieldRegex=function(e){var t=r.LegacyGlobal.get_ff_translation(e);if(t)return new RegExp(t)},e.prototype.parse=function(e,t){for(var r=null,i=0,o=this.operations;i<o.length;i++){var n;if((r=(0,o[i])(e,t))||!1===r)break}return r},e}();t.FieldParserAbstract=i}),i("background/services/form-parser/field-parsers/password-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/index","background/background.module","background/legacy"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var s=e.call(this)||this;return s.stringUtils=o.getService(i.ServiceType.StringUtils),s.siteService=o.getService(i.ServiceType.Site),t.excludedFields.length||(t.excludedFields=[{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_ssn_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_cccsc_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_securityanswer_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_captcha_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_ssn_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_cccsc_regexp")}]),n.LegacyGlobal.LPContentScriptFeatures.save_a_site_correct_username_assumptions?s.operations=[s.excludedFieldOperation,s.singlePasswordFieldOperation,s.multiplePasswordsOneExistingOperation,s.multiplePasswordOperation,s.passwordLikeAttribute]:s.operations=[s.excludedFieldOperation,s.multiplePasswordOperation,s.singlePasswordFieldOperation,s.multiplePasswordsOneExistingOperation,s.passwordLikeAttribute],s.operations=s.operations.map(function(e){return e.bind(s)}),s}return u(t,e),t.prototype.excludedFieldOperation=function(e,i){for(var o=0;o<e.fields.length;++o)for(var n=e.fields[o],s=0;s<t.excludedFields.length;++s){var a=t.excludedFields[s];if(a.regex){if("attr"===a.type&&r.FieldParserAbstract.regexMatches(a.regex,[n.id,n.attributes.name]))return!1;if("text"===a.type&&r.FieldParserAbstract.regexMatches(a.regex,n.label))return!1}}return null},t.prototype.singlePasswordFieldOperation=function(e,t){if(1===t.uniquePasswords.length){var r=t.uniquePasswords[0];return 2===t.passwordsByValue[r].count&&(2===e.fields.length?e.passwordChangeForm=!0:e.createAccountForm=!0),r}return null},t.prototype.multiplePasswordOperation=function(e,t){for(var r=0,i=t.uniquePasswords;r<i.length;r++){var o=i[r],n;if(t.passwordsByValue[o].count>1)return 2===t.uniquePasswords.length?(e.passwordChangeForm=!0,e.originalPassword=t.uniquePasswords[0]===o?t.uniquePasswords[1]:t.uniquePasswords[0]):e.createAccountForm=!0,o}return null},t.prototype.multiplePasswordsOneExistingOperation=function(e,t){if(2===t.uniquePasswords.length){var r=this.findMatchingPassword(this.siteService.getSites(e.url),t.uniquePasswords);if(r)return e.passwordChangeForm=!0,e.originalPassword=r,t.uniquePasswords[0]===r?t.uniquePasswords[1]:t.uniquePasswords[0]}return null},t.prototype.passwordLikeAttribute=function(e,t){for(var r=0,i=t.uniquePasswords;r<i.length;r++){var o=i[r],n=t.passwordsByValue[o].field,s=["pw","pass"];if(this.stringUtils.stringContains(n.attributes.name,s)||this.stringUtils.stringContains(n.id,s))return o}},t.prototype.findMatchingPassword=function(e,t){for(var r=0;r<e.length;++r){var i=this.siteService.findMatchingSitePassword(e[r],t);if(i)return i}return null},t.excludedFields=[],t}(r.FieldParserAbstract);t.PasswordFieldParser=s}),i("background/services/form-parser/field-parsers/user-name-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/service-type","background/legacy","background/background.module"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var s=e.call(this)||this;return s.isStrict=t,s.userNameRegEx=r.FieldParserAbstract.getFormFieldRegex("ff_username_regexp"),s.stringUtils=n.getService(i.ServiceType.StringUtils),s.isStrict?s.operations=[s.userNameLikeLabelOperation,s.uniqueEmailFieldOperation,s.userNameLikeAttributeOperation]:o.LegacyGlobal.LPContentScriptFeatures.save_a_site_strict_username_parsing?s.operations=[s.userNameLikeLabelOperation,s.uniqueEmailFieldOperation,s.userNameLikeAttributeOperation,s.singleTextFieldOperation,s.multipleTextFieldOperation,s.nearPasswordFieldOpeartion,s.existingUserNameOperation]:s.operations=[s.userNameLikeLabelOperation,s.singleTextFieldOperation,s.multipleTextFieldOperation,s.nearPasswordFieldOpeartion,s.existingUserNameOperation,s.uniqueEmailFieldOperation,s.userNameLikeAttributeOperation],s.operations=s.operations.map(function(e){return e.bind(s)}),s}return u(t,e),t.prototype.userNameLikeLabelOperation=function(e,t){if(this.userNameRegEx)for(var i=0,o=e.fields;i<o.length;i++){var n=o[i];if(r.FieldParserAbstract.regexMatches(this.userNameRegEx,n.label))return n.value}return null},t.prototype.userNameLikeAttributeOperation=function(e,t){for(var r=0,i=t.uniqueTextValues;r<i.length;r++){var o=i[r],n=t.textFieldsByValue[o].field,s="user";if(this.stringUtils.stringContains(n.attributes.name,s)||this.stringUtils.stringContains(n.id,s))return o}return null},t.prototype.singleTextFieldOperation=function(e,t){if(1===t.uniqueTextValues.length){var r=t.uniqueTextValues[0];return 2===t.textFieldsByValue[r].count&&(e.createAccountForm=!0),r}return null},t.prototype.multipleTextFieldOperation=function(e,t){for(var r=0,i=t.uniqueTextValues;r<i.length;r++){var o=i[r];if(t.textFieldsByValue[o].count>1)return e.createAccountForm=!0,o}return null},t.prototype.nearPasswordFieldOpeartion=function(e,t){for(var r=e.fields,i=1;i<r.length;++i){var o;if("password"===r[i].type){var n=r[i-1];if("password"!==n.type)return n.value}}return null},t.prototype.existingUserNameOperation=function(e,t){for(var r in o.LegacyGlobal.g_sites)if(t.uniqueTextValues.indexOf(o.LegacyGlobal.g_sites[r].unencryptedUsername)>-1)return o.LegacyGlobal.g_sites[r].unencryptedUsername;return null},t.prototype.uniqueEmailFieldOperation=function(e,r){for(var i=[],o=0,n=r.uniqueTextValues;o<n.length;o++){var s=n[o],a=s.match(t.emailRegex);a&&1===a.length&&i.push(s)}return 1===i.length?i[0]:null},t.emailRegex=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/g,t}(r.FieldParserAbstract);t.UserNameFieldParser=s}),i("background/services/form-parser/field-parsers/index",["require","exports","background/services/form-parser/field-parsers/password-field-parser","background/services/form-parser/field-parsers/user-name-field-parser"],function(e,t,r,i){function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),o(r),o(i)}),i("background/services/form-parser/parsed-form",["require","exports","background/background.module","common/enums/index","background/services/form-parser/form-meta-data","background/services/form-parser/field-parsers/index","background/legacy"],function(e,t,r,i,o,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.formProfile=null,this.userNameField=null,this.metaData=null,this._succeeded=!1,this._submitted=!1;var a=r.getService(i.ServiceType.Site);if(e.fields=e.fields||[],this.metaData=new o.FormMetaData(e),!e.password)if(s.LegacyGlobal.LPContentScriptFeatures.save_a_site_correct_username_assumptions){var u=(new n.PasswordFieldParser).parse(e,this.metaData);e.generatedPassword?e.password=e.generatedPassword:"string"==typeof u&&(e.password=u)}else{var u;if(e.generatedPassword)e.password=e.generatedPassword;else"string"==typeof(u=(new n.PasswordFieldParser).parse(e,this.metaData))&&(e.password=u)}var c,l=new n.UserNameFieldParser(t&&t.strict).parse(e,this.metaData),d=[],p;"string"==typeof l&&(d=a.getSites(e.url).filter(function(e){return a.hasMatchingSiteUserName(e,l)}),e.username&&0===d.length&&!e.createAccountForm||(e.username=l));if(e.username&&!e.createAccountForm)for(var f=0,m=e.fields;f<m.length;f++){var v=m[f];if(v.value===e.username){this.userNameField=v;break}}this.formProfile=e,this._submitted=!e.generatedPassword}return e.prototype.submitted=function(e){return"boolean"==typeof e&&(this._submitted=e),this._submitted},e.prototype.succeeded=function(e){return"boolean"==typeof e&&(this._succeeded=e),this._succeeded},e.prototype.getUsernameField=function(){return this.userNameField},e.prototype.getUsername=function(){return this.formProfile.username},e.prototype.getPassword=function(){return this.formProfile.password},e.prototype.getOriginalPassword=function(){return this.formProfile.originalPassword},e.prototype.getFormProfile=function(){return this.formProfile},e.prototype.getFormMetaData=function(){return this.metaData},e.prototype.getFields=function(){return this.formProfile.fields},e.prototype.isChangePasswordForm=function(){return!!this.formProfile.passwordChangeForm},e.prototype.isCreateAccountForm=function(){return!!this.formProfile.passwordChangeForm||!!this.formProfile.generatedPassword},e.prototype.isBasicAuthentication=function(){return!!this.formProfile.basicAuthentication},e.prototype.shouldSaveFields=function(){return!this.isChangePasswordForm()&&!this.isCreateAccountForm()},e.prototype.getURL=function(){return this.formProfile.url},e}();t.ParsedForm=a}),i("background/services/form-parser/form-parser.service",["require","exports","common/decorators/index","common/enums/index","background/services/form-parser/parsed-form"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.parse=function(e,t){return new o.ParsedForm(e,t)},e=a([r.RegisterService(i.ServiceType.FormParser)],e)}();t.FormParserService=n}),i("background/services/segment/events/save-site-dialog",["require","exports","common/enums/index","background/legacy","common/enums/save-site-action"],function(e,t,r,i,a){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){if(this.sourceTabId=e,this.properties=t,this.type=r.SegmentEventType.SaveSiteDialog,!e||"number"!=typeof e)throw new TypeError("Missing a valid source tab ID.");if(!t)throw new TypeError('Missing "properties" argument.');if(!t.saveSiteEvent)throw new TypeError('Missing "saveSiteEvent" property.');if(!t.defaultData||void 0===t.matchingSites)throw new TypeError("Unable to retrieve necessary site data from properties.");if(t.saveSiteEvent===r.SaveSiteDialogEventType.SaveSiteDialogAction)throw new TypeError("Action argument required for SaveSiteDialogAction events.")}return e.prototype.getProperties=function(){return n(this,void 0,void 0,function(){var e,t,i;return s(this,function(n){switch(n.label){case 0:return[4,this.getTabState(this.sourceTabId)];case 1:return e=n.sent(),t=this.getCommonProperties(e,this.properties),[2,i=o({},t,{Action:a.SaveSiteAction[this.properties.action],saveSiteEvent:r.SaveSiteDialogEventType[this.properties.saveSiteEvent]})]}})})},e.prototype.getCommonProperties=function(e,t){var r=t.sameDomain,i=t.generatedPassword,o=this.getViewState(),n;return{"Domain Sites":this.getDomainSites(e),"Matching Sites":this.getMatchingSites(e),Domain:this.getDomain(e,t),"Domain Changed":!r,"Generated Password":i,"View State":o}},e.prototype.getTabState=function(e){return n(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:return[4,new Promise(function(t){return i.LegacyGlobal.LPTabState.getStateByTabId(e,t)})];case 1:return(t=r.sent())?[2,t]:[2,null]}})})},e.prototype.getViewState=function(){var e=this.properties,t=e.matchingSites,r=e.defaultData;if(t.length>1)return"Update Select";if(1===t.length)return"Update";var i=r.domainSites,o=r.unencryptedUsername;return o&&""!==o?"Add":i.length>1?"Update Select":1===i.length?"Update":"Add"},e.prototype.getMatchingSites=function(e){var t=this.properties,r=t.matchingSites,i=t.defaultData,o=e.getMatchingSites();return o&&void 0!==o.length?o.length:r?r.length:0},e.prototype.getDomainSites=function(e){var t=this.properties.defaultData,r=e.getDomainSites();return r&&void 0!==r.length?r.length:t&&void 0!==t.domainSites?t.domainSites.length:0},e.prototype.getDomain=function(e,t){var r=t.defaultData,o;return t.sameDomain?e.domain:i.LegacyGlobal.lp_gettld_url(r.url)},e}();t.SaveSiteDialogEvent=u}),i("background/services/segment/events/event.factory",["require","exports","background/services/segment/events/index","common/enums/index"],function(e,t,r,i){function o(e,t,o){return n(this,void 0,void 0,function(){var n,a,u;return s(this,function(s){switch(s.label){case 0:switch(a="properties",e){case i.SegmentEventType.SaveSiteDialog:a="saveSiteDialogProperties",n=new r.SaveSiteDialogEvent(t,o);break;default:throw new Error("Unsupported Segment Event type: "+e)}return[4,n.getProperties()];case 1:return u=s.sent(),[2,[a,u]]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.createSegmentEvent=o}),i("background/services/segment/events/index",["require","exports","background/services/segment/events/save-site-dialog","background/services/segment/events/event.factory"],function(e,t,r,i){function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),o(r),o(i)}),i("background/services/segment/segment.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/services/segment/events/index","common/messaging/messaging"],function(e,t,r,i,o,u,c){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.send=function(e,t){o.LegacyGlobal.sendLpImprove(e,t)},e.prototype.sendTypedEvent=function(e,t){return n(this,void 0,void 0,function(){var r,o,n,a,l,d;return s(this,function(s){switch(s.label){case 0:return o=i.SegmentEventType[e],console.assert(o,"Segment event "+e+" is not a valid event!"),o?(n=c.getInvokatingMessageContext(),[4,u.createSegmentEvent(o,n.calleeTab.tabID,t)]):[3,2];case 1:a=s.sent(),l=a[0],(d=a[1])&&this.send(o,((r={})[l]=JSON.stringify(d),r)),s.label=2;case 2:return[2]}})})},a([r.Visible],e.prototype,"sendTypedEvent",null),e=a([r.RegisterService(i.ServiceType.Segment)],e)}();t.SegmentService=l}),i("background/services/site/site.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/background.module"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.siteGroups=new Map}return e.prototype.initialize=function(){this.stringUtils=n.getService(i.ServiceType.StringUtils)},e.prototype.getSites=function(e){var t=o.LegacyGlobal.lp_gettld_url(e),r=this.siteGroups.get(e)||{accountsVersion:NaN,sites:[]};return r.accountsVersion!==o.LegacyGlobal.g_local_accts_version&&(r.accountsVersion=o.LegacyGlobal.g_local_accts_version,r.sites=o.LegacyGlobal.reorderOnURL(o.LegacyGlobal.getsites(t),e),this.siteGroups.set(e,r)),r.sites},e.prototype.findSites=function(e,t,r){var i=this;return this.getSites(e).filter(function(e){return i.hasMatchingSiteUserName(e,t)}).filter(function(e){return i.findMatchingSitePassword(e,r)})},e.prototype.getMatchingSites=function(e,t,r){var i=this,o=this.getSites(e);if(o.length>0){if(t)return o.filter(function(e){return i.hasMatchingSiteUserName(e,t)});if(r)return o.filter(function(e){return i.findMatchingSitePassword(e,r)})}return o},e.prototype.getUserNames=function(e){return this.getSites(e).map(function(e){return e.unencryptedUsername})},e.prototype.decrypt=function(e,t){return o.LegacyGlobal.lpmdec_acct(t,!0,e,o.LegacyGlobal.g_shares)},e.prototype.findMatchingSitePassword=function(e,t){Array.isArray(t)||(t=[t]);var r=t.indexOf(this.decrypt(e,e.password));if(-1===r&&e.fields&&e.fields.length>0)for(var i=0;i<e.fields.length;++i){var o=e.fields[i];if("password"===o.type&&(r=t.indexOf(this.decrypt(e,o.value)))>-1)break}return r>-1?t[r]:null},e.prototype.hasMatchingSiteUserName=function(e,t){if(!t)return!1;if(this.userNamesMatch(e.unencryptedUsername,t))return!0;if(e.fields&&e.fields.length)for(var r=0,i=e.fields;r<i.length;r++){var o=i[r];switch(o.type){case"text":case"email":case"tel":if(this.userNamesMatch(this.decrypt(e,o.value),t))return!0}}return!1},e.prototype.userNamesMatch=function(e,t){return e===t||this.userNameInEmail(e,t)||this.userNameInEmail(t,e)||this.isMaskedUsername(e,t)},e.prototype.userNameInEmail=function(e,t){if(t&&t.indexOf("@")>-1){var r=t.split("@");return 2===r.length&&e===r[0]}return!1},e.prototype.isMaskedUsername=function(e,t){return!!this.stringUtils.containsMaskingCharacter(t)&&(e.length===t.length&&(e[0]===t[0]||e[e.length-1]===t[t.length-1]))},a([r.Visible],e.prototype,"getUserNames",null),e=a([r.RegisterService(i.ServiceType.Site)],e)}();t.SiteService=s}),i("background/services/web-request/web-request-shim.service",["require","exports","common/decorators/index","common/enums/index","background/background.module"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){var e=this;this.webRequest=o.getService(i.ServiceType.WebRequest);var t=o.getService(i.ServiceType.Topic);t.subscribe(i.TopicType.LoginFinished,function(){e.webRequest.isEnabled()&&(t.subscribe(i.TopicType.ProcessedFormSubmit,function(t){var r=t.password,i=t.tabId,o=t.inputValues;r&&e.handleOnBefore(i,o,"NONE")}),t.subscribe(i.TopicType.PasswordFormSubmitted,function(t){var r=t.form,i=t.tabId;r&&e.handleOnCompleted(i,"NONE",200)}))})},e.prototype.handleOnBefore=function(e,t,r){this.webRequest.isEnabled()&&this.webRequest.addRequest({requestBody:{formData:{inputValues:t}},requestId:r,tabId:e,method:void 0,url:void 0,timeStamp:void 0,frameId:void 0,parentFrameId:void 0,type:void 0})},e.prototype.handleOnCompleted=function(e,t,r){this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r})},e.prototype.handleOnError=function(e,t,r,i){this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r,error:i})},a([r.Visible],e.prototype,"handleOnBefore",null),a([r.Visible],e.prototype,"handleOnCompleted",null),a([r.Visible],e.prototype,"handleOnError",null),e=a([r.RegisterService(i.ServiceType.WebRequestShim)],e)}();t.WebRequestShimService=n}),i("background/services/web-request/request-resolvers/request-resolver.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.type=e}return Object.defineProperty(e.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),e}();t.RequestResolverAbstract=r}),i("background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract",["require","exports","background/services/web-request/request-resolvers/request-resolver.abstract","background/legacy","background/services/form-parser/parsed-form","background/background.module","common/enums/index"],function(e,t,r,i,o,a,c){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var r=e.call(this,t)||this;return r.siteService=a.getService(c.ServiceType.Site),r}return u(t,e),t.prototype.sendSegmentEvent=function(e,t,r){return n(this,void 0,void 0,function(){var i,o,n,a,u,c;return s(this,function(s){switch(s.label){case 0:return o=(i=e).send,n=["passwordsubmitted"],a={type:r},c=(u=JSON).stringify,[4,this.getPasswordSubmittedProperties(t)];case 1:return o.apply(i,n.concat([(a.passwordSubmittedProperties=c.apply(u,[s.sent()]),a)])),[2]}})})},t.prototype.getPasswordSubmittedProperties=function(e){return n(this,void 0,void 0,function(){var t,r,n,a,u;return s(this,function(s){switch(s.label){case 0:return t=new o.ParsedForm(e),[4,this.getTabState(e.tabId)];case 1:return r=s.sent(),n=e.fields.filter(function(e){var t;return"password"===e.type}).some(function(t){var r;return t.value===e.generatedPassword}),a=r.matchingSiteCount,[2,u={"Domain Sites":this.siteService.getSites(e.url).length,"Matching Sites":a,"Generated Password":n,"Input Counts":this.getInputCounts(t),"Password Changed":!!a&&this.isChangePassword(t),Settings:{"Show Save Site Notification Bar":i.LegacyGlobal.Preferences.get("showSaveNotificationBar"),"Show Change Notification Bar":i.LegacyGlobal.Preferences.get("showChangeNotificationBar"),"Never Add Site":i.LegacyGlobal.hasNeverSave(i.LegacyGlobal.g_currenturl,i.LegacyGlobal.lp_gettld_url(i.LegacyGlobal.g_currenturl))}}]}})})},t.prototype.getInputCounts=function(e){var t=e.getFormMetaData(),r=Object.keys(t.passwordsByValue).reduce(function(e,r){return e+t.passwordsByValue[r].count},0);return{Username:e.getUsername()?1:0,Password:r}},t.prototype.isChangePassword=function(e){var t=e.getFormProfile(),r=e.getPassword();if(t.currentPassword){if(t.originalPassword)return t.currentPassword!==t.originalPassword;if(this.siteService.getSites(t.url).length){var i=e.getUsername();if(i)return 0===this.siteService.findSites(t.url,i,t.originalPassword||r).length}}return!1},t.prototype.getTabState=function(e){return n(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:return[4,new Promise(function(t){return i.LegacyGlobal.LPTabState.getStateByTabId(e,t)})];case 1:return(t=r.sent())?[2,t]:[2,null]}})})},t}(r.RequestResolverAbstract);t.PasswordSubmittedRequestResolverAbstract=l}),i("background/services/web-request/request-resolvers/injected-password-submitted",["require","exports","background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,i.ResolverType.InjectedPasswordSubmitted)||this;return t.segmentService=o.getService(i.ServiceType.Segment),t}return u(t,e),t.prototype.resolveSuccess=function(t){e.prototype.sendSegmentEvent.call(this,this.segmentService,t,"inject")},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"inject",error:e,status:t})},t}(r.PasswordSubmittedRequestResolverAbstract);t.InjectedPasswordSubmittedResolver=n}),i("background/services/web-request/request-resolvers/password-submitted",["require","exports","background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,i.ResolverType.PasswordSubmitted)||this;return t.segmentService=o.getService(i.ServiceType.Segment),t}return u(t,e),t.prototype.resolveSuccess=function(t){e.prototype.sendSegmentEvent.call(this,this.segmentService,t,"webrequest")},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"webrequest",error:e,status:t})},t}(r.PasswordSubmittedRequestResolverAbstract);t.PasswordSubmittedResolver=n}),i("background/services/web-request/request-resolvers/index",["require","exports","background/services/web-request/request-resolvers/injected-password-submitted","background/services/web-request/request-resolvers/password-submitted"],function(e,t,r,i){function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),o(r),o(i)}),i("background/services/web-request/web-request.service",["require","exports","common/enums/index","common/decorators/index","background/legacy","background/background.module","background/services/web-request/request-resolvers/index"],function(e,t,r,i,o,n,s){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){var e=this;this.requests={},this.trackedFormProfiles={},this.onBeforeRequestListener=function(t){e.shouldTrackRequest(t)&&(e.requests[e.getRequestKey(t.tabId,t.requestId)]=t)},this.onCompletedListener=function(t){var r=t.tabId,i=t.requestId,o=e.getTrackedFormProfile(e.getRequestKey(r,i));o&&(o.profile.tabId=r,e.requestResolvers[o.action].resolveSuccess(o.profile))},this.onErrorOccurredListener=function(t){var r=t.tabId,i=t.requestId,o=t.statusCode,n=t.error,s=e.getTrackedFormProfile(e.getRequestKey(r,i));s&&e.requestResolvers[s.action].resolveError(n,o)},"undefined"!=typeof browser?this.webRequestApi=browser.webRequest:"undefined"!=typeof chrome&&(this.webRequestApi=chrome.webRequest)}return e.prototype.trackFormSubmission=function(e,t){this.trackedFormProfiles[e]={profiles:t}},e.prototype.isApiSupported=function(){return!!this.webRequestApi&&this.features.get(r.FeatureType.WebRequestEnabled)&&!o.LegacyGlobal.g_isedge},e.prototype.isEnabled=function(){return this.features.get(r.FeatureType.PasswordSubmittedEvent)},e.prototype.addRequest=function(e){this.onBeforeRequestListener(e)},e.prototype.resolveRequest=function(e){var t=e.tabId,r=e.requestId,i=e.statusCode,o=e.error;o?this.onErrorOccurredListener({tabId:t,requestId:r,statusCode:i,error:o}):this.onCompletedListener({tabId:t,requestId:r,statusCode:i})},e.prototype.shouldTrackRequest=function(e){return e.requestBody&&!e.requestBody.error&&(e.requestBody.formData||e.requestBody.raw)&&!o.LegacyGlobal.hasNeverEnableLP(e.url,o.LegacyGlobal.lp_gettld_url(e.url))},e.prototype.takeRequest=function(e){var t=this;if(!this.requests[e])return null;var r=this.requests[e];if(r)delete this.requests[e];else{var i=this.parseRequestKey(e).tabId,o=[];Object.keys(this.requests).forEach(function(e){t.parseRequestKey(e).tabId===i&&(o.push(t.requests[e]),delete t.requests[e])}),o.length&&(r=o[0])}return r},e.prototype.requestHasFormData=function(e,t){return e.some(function(e){return e.fields.some(function(e){return""!==e.value&&-1!==t.indexOf(e.value)})})},e.prototype.getTrackedFormProfile=function(e){var t=this.takeRequest(e);if(!t)return null;var i=this.getSubmittedDataString(t),o=this.trackedFormProfiles[t.tabId];if(!(o&&o.profiles&&o.profiles.length&&i&&this.requestHasFormData(o.profiles,i)))return null;var n=null,s;if(i){if(!(n=o.profiles.filter(function(e){return e.fields.some(function(t){return!(!e.currentPassword||""===t.value)&&(t.value===e.currentPassword&&i.indexOf(t.value)>-1)})})[0]))return null;s=e.indexOf("NONE")>-1?r.ResolverType.InjectedPasswordSubmitted:r.ResolverType.PasswordSubmitted,delete this.trackedFormProfiles[t.tabId]}var a=this.parseRequestKey(e).tabId;return this.requestHasRecentlyResolved(a)?null:{profile:n,action:s}},e.prototype.requestHasRecentlyResolved=function(e){return this.didTabResolveLoginRequest(e,!0)},e.prototype.getSubmittedDataString=function(e){return e.requestBody?e.requestBody.formData?JSON.stringify(e.requestBody.formData):e.requestBody.raw.reduce(function(e,t){return e+String.fromCharCode.apply(null,new Uint8Array(t.bytes))},""):null},e.prototype.initialize=function(){var e=this;this.requestResolvers=this.setupRequestResolvers(),this.features=n.getRepository(r.RepositoryType.Feature);var t=n.getService(r.ServiceType.Topic);t.subscribe(r.TopicType.LoginFinished,function(){return e.setup()}),t.subscribe(r.TopicType.ClearData,function(){return e.teardown()}),o.LegacyGlobal.LPPlatform.onTabClosed(function(t){delete e.trackedFormProfiles[t],Object.keys(e.requests).forEach(function(r){return e.parseRequestKey(r).tabId===t&&delete e.requests[r]})})},e.prototype.destroy=function(){this.teardown()},e.prototype.setup=function(){if(this.isApiSupported()&&this.isEnabled()){var e={urls:["<all_urls>"],types:["xmlhttprequest","main_frame","sub_frame","other"]};this.webRequestApi.onBeforeRequest.addListener(this.onBeforeRequestListener,e,["requestBody"]),this.webRequestApi.onCompleted.addListener(this.onCompletedListener,e,null),this.webRequestApi.onErrorOccurred.addListener(this.onErrorOccurredListener,e)}},e.prototype.teardown=function(){this.isApiSupported()&&this.isEnabled()&&(this.webRequestApi.onBeforeRequest.removeListener(this.onBeforeRequestListener),this.webRequestApi.onCompleted.removeListener(this.onCompletedListener),this.webRequestApi.onErrorOccurred.removeListener(this.onErrorOccurredListener))},e.prototype.setupRequestResolvers=function(){var e=[];return e[r.ResolverType.PasswordSubmitted]=new s.PasswordSubmittedResolver,e[r.ResolverType.InjectedPasswordSubmitted]=new s.InjectedPasswordSubmittedResolver,e},e.prototype.getRequestKey=function(e,t){return t||(t="NONE"),e+"-"+t},e.prototype.parseRequestKey=function(e){var t=e.split("-"),r=t[0],i=t[1];return{tabId:parseInt(r,10),requestId:i}},e.prototype.getTabState=function(e){var t=o.LegacyGlobal.LPTabState.getStateByTabIdImmediate(e);return t||null},e.prototype.didTabResolveLoginRequest=function(e,t){var r=this.getTabState(e);if(!r)return!1;var i=r.getLoginRequestRecentlyResolved();return void 0!==t&&r.setLoginRequestRecentlyResolved(),i},a([i.Visible],e.prototype,"trackFormSubmission",null),a([i.Visible],e.prototype,"isApiSupported",null),a([i.Visible],e.prototype,"isEnabled",null),e=a([i.RegisterService(r.ServiceType.WebRequest)],e)}();t.WebRequestService=u}),i("background/services/index",["require","exports","background/services/auto-fill/delegated-auto-fill.service","background/services/basic-auth/basic-auth.service","background/services/form-parser/form-parser.service","background/services/segment/segment.service","background/services/service-provider","background/services/site/site.service","background/services/web-request/web-request-shim.service","background/services/web-request/web-request.service","common/services/topic/topic.service","common/services/utils/string-utils.service"],function(e,t,r,i,o,n,s,a,u,c,l,d){function p(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),p(r),p(i),p(o),p(n),p(s),p(a),p(u),p(c),p(l),p(d)}),i("background/background.module",["require","exports","background/repositories/index","background/services/index","common/decorators/index","common/module.abstract","background/legacy"],function(e,t,r,i,o,a,c){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return window.addEventListener("beforeunload",function(){t.serviceProvider.teardown(),t.repositoryProvider.teardown()}),t}return u(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.initialize=function(){return n(this,void 0,void 0,function(){return s(this,function(e){return this.repositoryProvider=new r.RepositoryProvider(o.getRepositoryRegistry()),this.serviceProvider=new i.ServiceProvider(o.getServiceRegistry()),this.repositoryProvider.initialize(),this.serviceProvider.initialize(),[2]})})},t.prototype.postInitialize=function(){return n(this,void 0,void 0,function(){return s(this,function(e){return this.repositoryProvider.postInitialize(),this.serviceProvider.postInitialize(),[2]})})},t.prototype.getServiceProvider=function(){return this.serviceProvider},t.prototype.getRepositoryProvider=function(){return this.repositoryProvider},t.prototype.getService=function(e){var t=this.serviceProvider.getService(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.prototype.getRepository=function(e){var t=this.repositoryProvider.getRepository(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.instance=null,t}(a.ModuleAbstract);function d(e){return n(this,void 0,void 0,function(){var t,r,i;return s(this,function(o){if(t=[],e.interface)t.push(e.interface);else{if(!e.tabId)throw new TypeError("Invalid target provided.");if(!(r=c.LegacyGlobal.LPTabs.get({tabID:e.tabId})))throw new TypeError("No tab with id "+e.tabId+" found.");if(i=void 0,e.frameId&&"top"!==e.frameId){if("number"!=typeof e.frameId)throw new TypeError("Unsupported frame id value: "+e.frameId);i=r.getFrame(e.frameId)}else i=r.getTop();if(!i)throw new TypeError("No content script interface found for tab "+e.tabId);t.push(i)}return[2,t]})})}function p(e){return l.getInstance().getService(e)}function f(e){return l.getInstance().getRepository(e)}function m(e){return l.getInstance().isInitialized(e)}function v(e,t,r,i,o){void 0===r&&(r=[]),l.getInstance().getServiceProvider().call(e,t,r,i,o)}function g(e,t,r,i,o){void 0===r&&(r=[]),l.getInstance().getRepositoryProvider().call(e,t,r,i,o)}t.getContentScriptInterfaces=d,t.getService=p,t.getRepository=f,t.isInitialized=m,t.callService=v,t.callRepository=g,t.default=l.getInstance()}),e.LPModule=r("background/background.module")}).call(this);
//# sourceMappingURL=sourcemaps/modules-background.js.map
